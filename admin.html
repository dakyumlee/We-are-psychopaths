<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ê°ë… ê´€ë¦¬ íŒ¨ë„</title>
<style>
body {
    background-color: #4e2e1e;
    color: #f5f0e6;
    font-family: "Song Myung", serif;
}

.admin-panel {
    max-width: 1400px;
    margin: 0 auto;
    padding: 100px 20px 20px;
    font-family: "Song Myung", serif;
    background-color: #4e2e1e;
}

.panel-header {
    text-align: center;
    margin-bottom: 3rem;
    background: rgba(245, 240, 230, 0.05);
    padding: 2rem;
    border-radius: 12px;
    border-left: 4px solid #8d6e63;
}

.panel-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    color: #f5f0e6;
}

.panel-header p {
    color: #d4c4a8;
    font-size: 1.2em;
    margin: 0;
}

.management-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
    background: rgba(245, 240, 230, 0.05);
    border-radius: 12px;
    padding: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.tab-button {
    padding: 12px 24px;
    background: rgba(245, 240, 230, 0.1);
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 25px;
    color: #f5f0e6;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1.1em;
    transition: all 0.3s ease;
}

.tab-button:hover {
    background: rgba(245, 240, 230, 0.15);
    transform: translateY(-2px);
}

.tab-button.active {
    background: #8d6e63;
    border-color: #8d6e63;
    color: #f5f0e6;
}

.management-card {
    background: rgba(245, 240, 230, 0.05);
    border: 1px solid rgba(245, 240, 230, 0.1);
    border-left: 4px solid #8d6e63;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
}

.management-card:hover {
    background: rgba(245, 240, 230, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.card-title {
    color: #f5f0e6;
    font-size: 1.8em;
    margin-bottom: 1rem;
    text-align: center;
    border-bottom: 2px solid rgba(245, 240, 230, 0.2);
    padding-bottom: 0.5rem;
}

.section-info {
    background: rgba(141, 110, 99, 0.2);
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #8d6e63;
}

.section-info h4 {
    color: #f5f0e6;
    margin: 0 0 8px 0;
    font-size: 1.2em;
}

.section-info p {
    color: #d4c4a8;
    margin: 0;
    line-height: 1.4;
    font-size: 0.95em;
}

.form-section {
    margin-bottom: 2rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    color: #d4c4a8;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 1.1em;
}

.form-section input,
.form-section textarea,
.form-section select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 8px;
    background: rgba(245, 240, 230, 0.1);
    color: #f5f0e6;
    font-family: "Song Myung", serif;
    font-size: 1em;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.form-section input:focus,
.form-section textarea:focus,
.form-section select:focus {
    outline: none;
    border-color: #8d6e63;
    background: rgba(245, 240, 230, 0.15);
    box-shadow: 0 0 15px rgba(141, 110, 99, 0.3);
}

.form-section textarea {
    resize: vertical;
    min-height: 100px;
    line-height: 1.6;
}

.form-section button,
.action-btn {
    padding: 12px 25px;
    background: #8d6e63;
    color: #f5f0e6;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1.1em;
    transition: all 0.3s ease;
    min-width: 140px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.form-section button:hover,
.action-btn:hover {
    background: #a1887f;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(141, 110, 99, 0.4);
}

.danger-btn {
    background: #dc3545 !important;
}

.danger-btn:hover {
    background: #c82333 !important;
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4) !important;
}

.secondary-btn {
    background: rgba(245, 240, 230, 0.1) !important;
    border: 1px solid rgba(245, 240, 230, 0.2) !important;
}

.secondary-btn:hover {
    background: rgba(245, 240, 230, 0.15) !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
}

.login-section {
    max-width: 500px;
    margin: 200px auto;
    text-align: center;
    background: rgba(245, 240, 230, 0.05);
    padding: 3rem;
    border-radius: 12px;
    border-left: 4px solid #8d6e63;
}

.login-section h1 {
    color: #f5f0e6;
    font-size: 2.2em;
    margin-bottom: 20px;
}

.login-section p {
    color: #d4c4a8;
    font-size: 1.1em;
    line-height: 1.6;
    margin-bottom: 2rem;
}

.login-section input {
    width: 100%;
    max-width: 300px;
    padding: 15px 20px;
    margin: 15px 0;
    border: 1px solid rgba(245, 240, 230, 0.3);
    border-radius: 25px;
    background: rgba(245, 240, 230, 0.1);
    color: #f5f0e6;
    font-size: 1.1em;
    text-align: center;
    transition: all 0.3s ease;
}

.login-section input:focus {
    outline: none;
    border-color: #8d6e63;
    background: rgba(245, 240, 230, 0.15);
    box-shadow: 0 0 15px rgba(141, 110, 99, 0.3);
}

.login-section button {
    padding: 15px 30px;
    font-size: 1.2em;
    margin-top: 10px;
}

.logout-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    background: #dc3545;
    color: #f5f0e6;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1em;
    z-index: 1000;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.logout-btn:hover {
    background: #c82333;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

.status-message {
    padding: 15px 20px;
    margin: 15px 0;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    border-left: 4px solid;
}

.success {
    background: rgba(92, 184, 92, 0.2);
    color: #5cb85c;
    border-color: #5cb85c;
}

.error {
    background: rgba(217, 83, 79, 0.2);
    color: #d9534f;
    border-color: #d9534f;
}

.management-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.stat-card {
    background: rgba(141, 110, 99, 0.2);
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid rgba(245, 240, 230, 0.1);
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #f5f0e6;
    display: block;
    margin-bottom: 8px;
}

.stat-label {
    color: #d4c4a8;
    font-size: 1em;
}

.content-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 20px 0;
    border-top: 1px solid rgba(245, 240, 230, 0.2);
    padding-top: 20px;
}

.content-item {
    background: rgba(245, 240, 230, 0.05);
    border-left: 4px solid #8d6e63;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.content-item:hover {
    background: rgba(245, 240, 230, 0.1);
    transform: translateX(5px);
}

.content-item h4 {
    color: #f5f0e6;
    margin: 0 0 8px 0;
}

.content-item p {
    color: #d4c4a8;
    margin: 5px 0 0 0;
    font-size: 0.9em;
}

.urgent-item {
    border-left-color: #dc3545 !important;
    background: rgba(220, 53, 69, 0.1) !important;
}

.urgent-item h4 {
    color: #ff6b6b !important;
}

.file-info {
    margin-top: 8px;
    padding: 8px 12px;
    background: rgba(141, 110, 99, 0.2);
    border-radius: 6px;
    font-size: 0.9em;
    color: #d4c4a8;
}

.delete-btn {
    background: #dc3545 !important;
    color: #f5f0e6 !important;
    border: none !important;
    padding: 6px 12px !important;
    border-radius: 15px !important;
    font-size: 0.85em !important;
    margin-left: 10px !important;
    min-width: auto !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

.delete-btn:hover {
    background: #c82333 !important;
    transform: translateY(-1px) !important;
}

.content-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.content-item-actions {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
}

.content-preview {
    max-width: 100px;
    max-height: 60px;
    object-fit: cover;
    border-radius: 4px;
    margin-right: 10px;
    float: left;
}

.hidden {
    display: none !important;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
}

.chat-detail-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.chat-detail-content {
    background: #4e2e1e;
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 12px;
    padding: 30px;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    color: #f5f0e6;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    color: #f5f0e6;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: #dc3545;
}

.chat-message {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #8d6e63;
}

.chat-message.user {
    background: rgba(141, 110, 99, 0.2);
    border-left-color: #8d6e63;
}

.chat-message.bot {
    background: rgba(245, 240, 230, 0.1);
    border-left-color: #d4c4a8;
}

.chat-message h5 {
    margin: 0 0 10px 0;
    color: #f5f0e6;
    font-size: 1.1em;
}

.chat-message p {
    margin: 0;
    line-height: 1.6;
    white-space: pre-wrap;
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

@media (max-width: 768px) {
    .admin-panel {
        padding: 120px 15px 20px;
    }
    
    .panel-header {
        padding: 1.5rem;
    }
    
    .panel-header h1 {
        font-size: 2em;
    }
    
    .management-tabs {
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }
    
    .tab-button {
        width: 100%;
        max-width: 300px;
        text-align: center;
    }
    
    .management-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .management-card {
        padding: 1.5rem;
    }
    
    .login-section {
        margin: 120px auto;
        padding: 2rem;
    }
    
    .login-section h1 {
        font-size: 1.8em;
    }

    .chat-detail-content {
        margin: 20px;
        max-width: calc(100vw - 40px);
        max-height: calc(100vh - 40px);
    }
}
</style>
</head>
<body class="song-myung-regular">

<div id="login-section" class="login-section">
<h1>ğŸ¬ ê°ë… ê´€ë¦¬ íŒ¨ë„</h1>
<p>
    ì´ í˜ì´ì§€ëŠ” ê°ë… ì „ìš©ì…ë‹ˆë‹¤.<br>
    ë§ˆìŠ¤í„°í‚¤ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.
</p>
<input type="password" id="master-key" placeholder="ë§ˆìŠ¤í„°í‚¤ ì…ë ¥" />
<br>
<button id="login-btn">ë¡œê·¸ì¸</button>
<div id="login-message" style="margin-top: 1rem;"></div>
</div>

<div id="admin-panel" class="admin-panel hidden">
<button class="logout-btn" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>

<div class="panel-header">
    <h1>ğŸ¬ ê°ë… ê´€ë¦¬ íŒ¨ë„</h1>
    <p>ëª¨ë“  ì½˜í…ì¸ ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”</p>
</div>

<div class="management-tabs">
    <button class="tab-button active" onclick="showTab('timeline')">â° ë‚˜ì˜ íƒ€ì„ë¼ì¸</button>
    <button class="tab-button" onclick="showTab('video')">ğŸ¥ ë‹¤í ì˜ìƒ</button>
    <button class="tab-button" onclick="showTab('archive-timeline')">ğŸ“… ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸</button>
    <button class="tab-button" onclick="showTab('archive-videos')">ğŸ¬ ì•„ì¹´ì´ë¸Œ ì˜ìƒ</button>
    <button class="tab-button" onclick="showTab('archive-gallery')">ğŸ“¸ ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬</button>
    <button class="tab-button" onclick="showTab('chatbot')">ğŸ’¬ ì±—ë´‡ ë¶„ì„</button>
    <button class="tab-button" onclick="showTab('system')">âš™ï¸ ì‹œìŠ¤í…œ ë¡œê·¸</button>
</div>

<div id="timeline-tab" class="tab-content active">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">â° ê°œì¸ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì¶”ê°€</h2>
            <div class="section-info">
                <h4>ğŸ“ ì—…ë¡œë“œ ìœ„ì¹˜</h4>
                <p>ì—¬ê¸°ì„œ ì¶”ê°€í•œ ì´ë²¤íŠ¸ëŠ” <strong>"ë‚˜ì˜ ì •ì‹ ë³‘ ì¼ì§€" í˜ì´ì§€ì˜ íƒ€ì„ë¼ì¸</strong>ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            <form id="timeline-form" class="form-section">
                <div class="form-group">
                    <label for="person-select">ì¸ë¬¼ ì„ íƒ</label>
                    <select id="person-select" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="jueun">ì£¼ì€</option>
                        <option value="soonkyung">ìˆœê²½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timeline-date">ë‚ ì§œ</label>
                    <input type="date" id="timeline-date" required />
                </div>
                <div class="form-group">
                    <label for="timeline-title">ì´ë²¤íŠ¸ ì œëª©</label>
                    <input type="text" id="timeline-title" placeholder="ì´ë²¤íŠ¸ ì œëª©" required />
                </div>
                <div class="form-group">
                    <label for="timeline-content">ì´ë²¤íŠ¸ ë‚´ìš©</label>
                    <textarea id="timeline-content" rows="4" placeholder="íƒ€ì„ë¼ì¸ì— ì¶”ê°€í•  ì´ë²¤íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                </div>
                <button type="submit">ì´ë²¤íŠ¸ ì¶”ê°€</button>
            </form>
            <div id="timeline-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“‹ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ëª©ë¡</h2>
            <div id="timeline-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-timeline-btn" class="action-btn secondary-btn" style="width: 100%;">
                ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="video-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ¥ ë‹¤í ì˜ìƒ ì—…ë¡œë“œ</h2>
            <div class="section-info">
                <h4>ğŸ“ ì—…ë¡œë“œ ìœ„ì¹˜</h4>
                <p>ì—¬ê¸°ì„œ ì—…ë¡œë“œí•œ ì˜ìƒì€ <strong>"ì˜í™” í˜ì´ì§€ì˜ ë‹¤í ì˜ìƒ" ì„¹ì…˜</strong>ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            <form id="video-form" class="form-section">
                <div class="form-group">
                    <label for="video-title">ì˜ìƒ ì œëª©</label>
                    <input type="text" id="video-title" placeholder="ì˜ìƒ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required />
                </div>
                <div class="form-group">
                    <label for="video-description">ì˜ìƒ ì„¤ëª…</label>
                    <textarea id="video-description" rows="3" placeholder="ì˜ìƒì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                
                <div class="form-group">
                    <label>ì˜ìƒ ì—…ë¡œë“œ ë°©ì‹</label>
                    <div style="margin: 10px 0;">
                        <label style="margin-right: 20px;">
                            <input type="radio" name="video-type" value="youtube" checked> YouTube ë§í¬
                        </label>
                        <label>
                            <input type="radio" name="video-type" value="file"> íŒŒì¼ ì—…ë¡œë“œ
                        </label>
                    </div>
                </div>
                
                <div id="youtube-input" class="form-group">
                    <label for="youtube-url">YouTube URL</label>
                    <input type="url" id="youtube-url" placeholder="https://www.youtube.com/watch?v=..." />
                </div>
                
                <div id="file-input" class="form-group" style="display:none;">
                    <label for="video-file">ë¹„ë””ì˜¤ íŒŒì¼</label>
                    <input type="file" id="video-file" accept=".mp4,.webm,.mov,.avi,.mkv,.flv,video/*" />
                    <div id="video-file-info" class="file-info"></div>
                </div>
                
                <button type="submit">ì˜ìƒ ì—…ë¡œë“œ</button>
            </form>
            <div id="video-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“‹ ì—…ë¡œë“œëœ ì˜ìƒ ëª©ë¡</h2>
            <div id="video-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-video-btn" class="action-btn secondary-btn" style="width: 100%;">
                ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="archive-timeline-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ“… ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸</h2>
            <div class="section-info">
                <h4>ğŸ“ ì—…ë¡œë“œ ìœ„ì¹˜</h4>
                <p>ì—¬ê¸°ì„œ ì¶”ê°€í•œ ì´ë²¤íŠ¸ëŠ” <strong>"ì•„ì¹´ì´ë¹™" í˜ì´ì§€ì˜ íƒ€ì„ë¼ì¸</strong>ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            <form id="archive-timeline-form" class="form-section">
                <div class="form-group">
                    <label for="archive-event-date">ë‚ ì§œ</label>
                    <input type="date" id="archive-event-date" required />
                </div>
                <div class="form-group">
                    <label for="archive-event-title">ì´ë²¤íŠ¸ ì œëª©</label>
                    <input type="text" id="archive-event-title" placeholder="í”„ë¡œì íŠ¸ ì‹œì‘" required />
                </div>
                <div class="form-group">
                    <label for="archive-event-description">ì´ë²¤íŠ¸ ì„¤ëª…</label>
                    <textarea id="archive-event-description" rows="4" placeholder="ì´ë²¤íŠ¸ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                </div>
                <button type="submit">íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì¶”ê°€</button>
            </form>
            <div id="archive-timeline-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“‹ ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ëª©ë¡</h2>
            <div id="archive-timeline-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-archive-timeline-btn" class="action-btn secondary-btn" style="width: 100%;">
                ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="archive-videos-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ¬ ì•„ì¹´ì´ë¸Œ ì˜ìƒ</h2>
            <div class="section-info">
                <h4>ğŸ“ ì—…ë¡œë“œ ìœ„ì¹˜</h4>
                <p>ì—¬ê¸°ì„œ ì¶”ê°€í•œ ì˜ìƒì€ <strong>"ì•„ì¹´ì´ë¹™" í˜ì´ì§€ì˜ ì˜ìƒ ì„¹ì…˜</strong>ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            <form id="archive-video-form" class="form-section">
                <div class="form-group">
                    <label for="archive-video-title">ì˜ìƒ ì œëª©</label>
                    <input type="text" id="archive-video-title" placeholder="í”„ë¡œì íŠ¸ í‹°ì € ì˜ìƒ" required />
                </div>
                <div class="form-group">
                    <label for="archive-video-description">ì˜ìƒ ì„¤ëª…</label>
                    <textarea id="archive-video-description" rows="3" placeholder="ì˜ìƒì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>ì˜ìƒ ì—…ë¡œë“œ ë°©ì‹</label>
                    <div style="margin: 10px 0;">
                        <label style="margin-right: 20px;">
                            <input type="radio" name="archive-video-type" value="youtube" checked> YouTube ë§í¬
                        </label>
                        <label>
                            <input type="radio" name="archive-video-type" value="file"> íŒŒì¼ ì—…ë¡œë“œ
                        </label>
                    </div>
                </div>
                
                <div id="archive-youtube-input" class="form-group">
                    <label for="archive-video-url">YouTube URL</label>
                    <input type="url" id="archive-video-url" placeholder="https://www.youtube.com/watch?v=..." />
                </div>
                
                <div id="archive-file-input" class="form-group" style="display:none;">
                    <label for="archive-video-file">ë¹„ë””ì˜¤ íŒŒì¼</label>
                    <input type="file" id="archive-video-file" accept=".mp4,.webm,.mov,.avi,.mkv,.flv,video/*" />
                    <div id="archive-video-file-info" class="file-info"></div>
                </div>
                
                <div class="form-group">
                    <label for="archive-video-duration">ì˜ìƒ ê¸¸ì´</label>
                    <input type="text" id="archive-video-duration" placeholder="2:30" required />
                </div>
                <button type="submit">ì˜ìƒ ì¶”ê°€</button>
            </form>
            <div id="archive-video-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“‹ ì•„ì¹´ì´ë¸Œ ì˜ìƒ ëª©ë¡</h2>
            <div id="archive-videos-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-archive-videos-btn" class="action-btn secondary-btn" style="width: 100%;">
                ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="archive-gallery-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ“¸ ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬</h2>
            <div class="section-info">
                <h4>ğŸ“ ì—…ë¡œë“œ ìœ„ì¹˜</h4>
                <p>ì—¬ê¸°ì„œ ì—…ë¡œë“œí•œ ì‚¬ì§„ì€ <strong>"ì•„ì¹´ì´ë¹™" í˜ì´ì§€ì˜ ê°¤ëŸ¬ë¦¬ ì„¹ì…˜</strong>ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            <form id="archive-gallery-form" class="form-section">
                <div class="form-group">
                    <label for="archive-gallery-image">ì‚¬ì§„ ì„ íƒ</label>
                    <input type="file" id="archive-gallery-image" accept="image/*" required />
                    <div id="archive-gallery-file-info" class="file-info"></div>
                </div>
                <div class="form-group">
                    <label for="archive-gallery-title">ì‚¬ì§„ ì œëª©</label>
                    <input type="text" id="archive-gallery-title" placeholder="ì²« ë²ˆì§¸ ì´¬ì˜ í˜„ì¥" required />
                </div>
                <div class="form-group">
                    <label for="archive-gallery-description">ì‚¬ì§„ ì„¤ëª…</label>
                    <textarea id="archive-gallery-description" rows="3" placeholder="ì‚¬ì§„ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                </div>
                <div class="form-group">
                    <label for="archive-gallery-category">ì¹´í…Œê³ ë¦¬</label>
                    <select id="archive-gallery-category" required>
                        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                        <option value="production">ì œì‘ í˜„ì¥</option>
                        <option value="interview">ì¸í„°ë·°</option>
                        <option value="daily">ì¼ìƒ</option>
                        <option value="document">ìë£Œ</option>
                    </select>
                </div>
                <button type="submit">ê°¤ëŸ¬ë¦¬ì— ì¶”ê°€</button>
            </form>
            <div id="archive-gallery-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“‹ ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ëª©ë¡</h2>
            <div id="archive-gallery-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ê°¤ëŸ¬ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-archive-gallery-btn" class="action-btn secondary-btn" style="width: 100%;">
                ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="chatbot-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ“Š ëŒ€í™” í†µê³„</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-chats">-</span>
                    <span class="stat-label">ì´ ëŒ€í™” ìˆ˜</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="active-users">-</span>
                    <span class="stat-label">í™œì„± ì‚¬ìš©ì</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="today-chats">-</span>
                    <span class="stat-label">ì˜¤ëŠ˜ ëŒ€í™”</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avg-messages">-</span>
                    <span class="stat-label">í‰ê·  ë©”ì‹œì§€ ìˆ˜</span>
                </div>
            </div>
            <button type="button" id="refresh-stats-btn" class="action-btn secondary-btn" style="width: 100%;">
                í†µê³„ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ˜¢ ê°ì • ë¶„ì„</h2>
            <div id="emotion-analysis" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ê°ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-emotions-btn" class="action-btn secondary-btn" style="width: 100%;">
                ê°ì • ë¶„ì„ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸš¨ ê¸´ê¸‰ ìƒí™©</h2>
            <div id="urgent-messages" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ê¸´ê¸‰ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-urgent-btn" class="action-btn danger-btn" style="width: 100%;">
                ê¸´ê¸‰ ìƒí™© ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>

    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ’¬ ì „ì²´ ëŒ€í™” ëª©ë¡</h2>
            <div id="all-chats" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì „ì²´ ëŒ€í™”ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-all-chats-btn" class="action-btn secondary-btn" style="width: 100%;">
                ì „ì²´ ëŒ€í™” ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“ˆ ì£¼ì œë³„ ë¶„ì„</h2>
            <div id="topic-analysis" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì£¼ì œ ë¶„ì„ ì¤‘...</p>
            </div>
            <button type="button" id="refresh-topics-btn" class="action-btn secondary-btn" style="width: 100%;">
                ì£¼ì œ ë¶„ì„ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>
</div>

<div id="system-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">âš™ï¸ ì‹œìŠ¤í…œ ë¡œê·¸</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-errors">-</span>
                    <span class="stat-label">ì´ ì˜¤ë¥˜ ìˆ˜</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="today-errors">-</span>
                    <span class="stat-label">ì˜¤ëŠ˜ ì˜¤ë¥˜</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="active-sessions">-</span>
                    <span class="stat-label">í™œì„± ì„¸ì…˜</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="uptime-hours">-</span>
                    <span class="stat-label">ê°€ë™ ì‹œê°„(ì‹œê°„)</span>
                </div>
            </div>
            <button type="button" id="refresh-system-btn" class="action-btn secondary-btn" style="width: 100%;">
                ì‹œìŠ¤í…œ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸš¨ ì˜¤ë¥˜ ë¡œê·¸</h2>
            <div id="error-logs" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-errors-btn" class="action-btn secondary-btn" style="width: 100%;">
                ì˜¤ë¥˜ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“Š í™œë™ ë¡œê·¸</h2>
            <div id="activity-logs" class="content-list">
                <p style="text-align: center; color: #8d6e63;">í™œë™ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-activity-btn" class="action-btn secondary-btn" style="width: 100%;">
                í™œë™ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>

    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ</h2>
            <div id="database-status" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-db-btn" class="action-btn secondary-btn" style="width: 100%;">
                DB ìƒíƒœ í™•ì¸
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ</h2>
            <div id="performance-metrics" class="content-list">
                <p style="text-align: center; color: #8d6e63;">ì„±ëŠ¥ ì§€í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <button type="button" id="refresh-performance-btn" class="action-btn secondary-btn" style="width: 100%;">
                ì„±ëŠ¥ ì§€í‘œ ìƒˆë¡œê³ ì¹¨
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">ğŸ”§ ì‹œìŠ¤í…œ ê´€ë¦¬</h2>
            <div class="form-section">
                <button type="button" id="clear-old-logs-btn" class="action-btn danger-btn" style="width: 100%; margin-bottom: 10px;">
                    ì˜¤ë˜ëœ ë¡œê·¸ ì •ë¦¬ (30ì¼ ì´ìƒ)
                </button>
                <button type="button" id="backup-data-btn" class="action-btn secondary-btn" style="width: 100%; margin-bottom: 10px;">
                    ë°ì´í„° ë°±ì—… ìƒì„±
                </button>
                <button type="button" id="system-health-check-btn" class="action-btn" style="width: 100%;">
                    ì‹œìŠ¤í…œ ê±´ê°• ì²´í¬
                </button>
            </div>
            <div id="system-management-message"></div>
        </div>
    </div>
</div>

</div>

<div id="chat-detail-modal" class="chat-detail-modal">
    <div class="chat-detail-content">
        <button class="modal-close">&times;</button>
        <h3 id="chat-detail-title">ëŒ€í™” ë‚´ìš©</h3>
        <div id="chat-detail-body"></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, orderBy, deleteDoc, doc, where, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL, uploadBytesResumable, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIU8q64ZB6g8D72SPcCxxkOQmhtREN9cg",
  authDomain: "we-are-psychopath.firebaseapp.com",
  projectId: "we-are-psychopath",
  storageBucket: "we-are-psychopath.firebasestorage.app",
  messagingSenderId: "1020831167882",
  appId: "1:1020831167882:web:addcfd266307c3bb71c473",
  measurementId: "G-MG2X69DDK8"
};

const MASTER_KEY = "189512";

const loginSection = document.getElementById("login-section");
const adminPanel = document.getElementById("admin-panel");
const masterKeyInput = document.getElementById("master-key");
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const loginMessage = document.getElementById("login-message");

let app, db, storage;

function showMessage(element, message, type = "success") {
    if (!element) return;
    element.innerHTML = `<div class="status-message ${type}">${message}</div>`;
    setTimeout(() => {
        if (element.innerHTML.includes(message)) {
            element.innerHTML = "";
        }
    }, 5000);
}

function clearAllForms() {
    const forms = document.querySelectorAll("form");
    forms.forEach(form => form.reset());
    
    const fileInfoElements = document.querySelectorAll(".file-info");
    fileInfoElements.forEach(el => el.innerHTML = "");
    
    const messageElements = document.querySelectorAll("[id$='-message']");
    messageElements.forEach(el => el.innerHTML = "");
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function displayFileInfo(inputElement, infoElement) {
    if (!inputElement || !infoElement) return;
    
    inputElement.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const fileSize = formatFileSize(file.size);
            const fileType = file.type || 'ì•Œ ìˆ˜ ì—†ìŒ';
            infoElement.innerHTML = `
                <strong>ì„ íƒëœ íŒŒì¼:</strong> ${file.name}<br>
                <strong>í¬ê¸°:</strong> ${fileSize}<br>
                <strong>í˜•ì‹:</strong> ${fileType}
            `;
        } else {
            infoElement.innerHTML = "";
        }
    });
}

function convertToEmbedUrl(url) {
    if (!url) return '';
    
    const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
    if (youtubeMatch) {
        return `https://www.youtube.com/embed/${youtubeMatch[1]}`;
    }
    
    const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
    if (vimeoMatch) {
        return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
    }
    
    return url;
}

async function initializeFirebase() {
  try {
    if (!app) {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      storage = getStorage(app);
      
      window.db = db;
      window.storage = storage;
      
      return true;
    }
    return true;
  } catch (error) {
    console.error("Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
    return false;
  }
}

document.addEventListener("DOMContentLoaded", async () => {
    await initializeFirebase();
});

async function handleLogin() {
    const inputKey = masterKeyInput.value.trim();
    
    if (inputKey === MASTER_KEY) {
        showMessage(loginMessage, "ë¡œê·¸ì¸ ì„±ê³µ!", "success");
        
        const firebaseReady = await initializeFirebase();
        
        setTimeout(() => {
            loginSection.classList.add("hidden");
            adminPanel.classList.remove("hidden");
            
            if (firebaseReady) {
                initializeForms();
                loadChatbotStats();
                loadTimelineList();
                loadVideoList();
                loadArchiveTimelineList();
                loadArchiveVideosList();
                loadArchiveGalleryList();
            }
        }, 500);
    } else {
        showMessage(loginMessage, "ë§ˆìŠ¤í„°í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", "error");
    }
}

loginBtn.addEventListener("click", handleLogin);

masterKeyInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
        handleLogin();
    }
});

logoutBtn.addEventListener("click", () => {
    if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        adminPanel.classList.add("hidden");
        loginSection.classList.remove("hidden");
        masterKeyInput.value = "";
        clearAllForms();
    }
});

window.showTab = function(tabName) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');
    
    if (tabName === 'chatbot') {
        loadChatbotStats();
    } else if (tabName === 'timeline') {
        loadTimelineList();
    } else if (tabName === 'video') {
        loadVideoList();
    } else if (tabName === 'archive-timeline') {
        loadArchiveTimelineList();
    } else if (tabName === 'archive-videos') {
        loadArchiveVideosList();
    } else if (tabName === 'archive-gallery') {
        loadArchiveGalleryList();
    } else if (tabName === 'system') {
        loadSystemLogs();
    }
};

function initializeForms() {
    const timelineForm = document.getElementById("timeline-form");
    if (timelineForm) {
        timelineForm.addEventListener("submit", handleTimelineSubmit);
    }
    
    const videoForm = document.getElementById("video-form");
    if (videoForm) {
        videoForm.addEventListener("submit", handleVideoSubmit);
        setupVideoForm();
        displayFileInfo(
            document.getElementById("video-file"),
            document.getElementById("video-file-info")
        );
    }
    
    initializeArchiveForms();
    initializeChatbotButtons();
    setupChatDetailModal();
}

function setupVideoForm() {
    const videoTypeRadios = document.querySelectorAll('input[name="video-type"]');
    const youtubeInput = document.getElementById("youtube-input");
    const fileInput = document.getElementById("file-input");
    
    videoTypeRadios.forEach(radio => {
        radio.addEventListener("change", () => {
            if (radio.value === "youtube") {
                youtubeInput.style.display = "block";
                fileInput.style.display = "none";
            } else {
                youtubeInput.style.display = "none";
                fileInput.style.display = "block";
            }
        });
    });
}

function setupChatDetailModal() {
    const modal = document.getElementById('chat-detail-modal');
    const closeBtn = modal.querySelector('.modal-close');
    
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.style.display === 'flex') {
            modal.style.display = 'none';
        }
    });
}

function openChatModal(userMessage, botMessage, timestampSeconds) {
    console.log('openChatModal í˜¸ì¶œë¨:', { userMessage, botMessage, timestampSeconds });
    
    const modal = document.getElementById('chat-detail-modal');
    const title = document.getElementById('chat-detail-title');
    const body = document.getElementById('chat-detail-body');
    
    if (!modal || !title || !body) {
        console.error('ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { modal: !!modal, title: !!title, body: !!body });
        return;
    }
    
    const timeString = timestampSeconds && timestampSeconds > 0 ? 
        new Date(timestampSeconds * 1000).toLocaleString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        }) : 'ì‹œê°„ ë¯¸ìƒ';
    
    title.textContent = `ğŸ’¬ ëŒ€í™” ìƒì„¸ ë‚´ìš©`;
    
    const safeUserMessage = userMessage || 'ë©”ì‹œì§€ ì—†ìŒ';
    const safeBotMessage = botMessage || 'ì‘ë‹µ ì—†ìŒ';
    
    body.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px; padding: 10px; background: rgba(245, 240, 230, 0.05); border-radius: 8px;">
            <p style="margin: 0; color: #d4c4a8;"><strong>ğŸ“… ëŒ€í™” ì‹œê°„:</strong> ${timeString}</p>
        </div>
        
        <div class="chat-message user" style="background: rgba(141, 110, 99, 0.2); border-left: 4px solid #8d6e63; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h5 style="margin: 0 0 15px 0; color: #f5f0e6; font-size: 1.2em; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ‘¤</span> ì‚¬ìš©ì ë©”ì‹œì§€
            </h5>
            <div style="background: rgba(245, 240, 230, 0.1); padding: 15px; border-radius: 6px; line-height: 1.6;">
                <p style="margin: 0; white-space: pre-wrap; color: #f5f0e6;">${safeUserMessage}</p>
            </div>
        </div>
        
        <div class="chat-message bot" style="background: rgba(245, 240, 230, 0.1); border-left: 4px solid #d4c4a8; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h5 style="margin: 0 0 15px 0; color: #f5f0e6; font-size: 1.2em; display: flex; align-items: center;">
                <span style="margin-right: 10px;">ğŸ¤–</span> ìƒë‹´ì‚¬ ì‘ë‹µ
            </h5>
            <div style="background: rgba(141, 110, 99, 0.1); padding: 15px; border-radius: 6px; line-height: 1.6;">
                <p style="margin: 0; white-space: pre-wrap; color: #f5f0e6;">${safeBotMessage}</p>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px; padding: 10px; border-top: 1px solid rgba(245, 240, 230, 0.2);">
            <p style="margin: 0; color: #d4c4a8; font-size: 0.9em;">ì´ ëŒ€í™”ëŠ” ìƒë‹´ ëª©ì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        </div>
    `;
    
    modal.style.display = 'flex';
    console.log('ëª¨ë‹¬ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
    
    setTimeout(() => {
        modal.style.opacity = '1';
    }, 10);
}

async function handleTimelineSubmit(e) {
    e.preventDefault();
    
    const person = document.getElementById("person-select").value;
    const date = document.getElementById("timeline-date").value;
    const title = document.getElementById("timeline-title").value.trim();
    const content = document.getElementById("timeline-content").value.trim();
    
    if (!person || !date || !title || !content) {
        showMessage(document.getElementById("timeline-message"), "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "personalTimeline"), {
            person,
            date,
            title,
            content,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("timeline-message"), "íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
        document.getElementById("timeline-form").reset();
        loadTimelineList();
    } catch (error) {
        console.error("íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:", error);
        showMessage(document.getElementById("timeline-message"), "ì´ë²¤íŠ¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
    }
}

async function handleVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("video-title").value.trim();
    const description = document.getElementById("video-description").value.trim();
    const videoType = document.querySelector('input[name="video-type"]:checked').value;
    
    if (!title) {
        showMessage(document.getElementById("video-message"), "ì˜ìƒ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
    }
    
    try {
        let videoUrl = "";
        let isYoutube = false;
        
        if (videoType === "youtube") {
            const youtubeUrl = document.getElementById("youtube-url").value.trim();
            if (!youtubeUrl) {
                showMessage(document.getElementById("video-message"), "YouTube ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                return;
            }
            videoUrl = convertToEmbedUrl(youtubeUrl);
            isYoutube = true;
        } else {
            const videoFile = document.getElementById("video-file").files[0];
            if (!videoFile) {
                showMessage(document.getElementById("video-message"), "ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
                return;
            }
            
            const storageRef = ref(window.storage, `videos/${videoFile.name}_${Date.now()}`);
            await uploadBytes(storageRef, videoFile);
            videoUrl = await getDownloadURL(storageRef);
            isYoutube = false;
        }
        
        await addDoc(collection(window.db, "documentaryVideos"), {
            title,
            description,
            videoUrl,
            isYoutube,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("video-message"), "ì˜ìƒì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
        document.getElementById("video-form").reset();
        document.getElementById("video-file-info").innerHTML = "";
        loadVideoList();
    } catch (error) {
        console.error("ì˜ìƒ ì—…ë¡œë“œ ì˜¤ë¥˜:", error);
        showMessage(document.getElementById("video-message"), "ì˜ìƒ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
    }
}

function initializeArchiveForms() {
    const archiveTimelineForm = document.getElementById("archive-timeline-form");
    if (archiveTimelineForm) {
        archiveTimelineForm.addEventListener("submit", handleArchiveTimelineSubmit);
    }
    
    const archiveVideoForm = document.getElementById("archive-video-form");
    if (archiveVideoForm) {
        archiveVideoForm.addEventListener("submit", handleArchiveVideoSubmit);
        setupArchiveVideoForm();
        displayFileInfo(
            document.getElementById("archive-video-file"),
            document.getElementById("archive-video-file-info")
        );
    }
    
    const archiveGalleryForm = document.getElementById("archive-gallery-form");
    if (archiveGalleryForm) {
        archiveGalleryForm.addEventListener("submit", handleArchiveGallerySubmit);
        displayFileInfo(
            document.getElementById("archive-gallery-image"),
            document.getElementById("archive-gallery-file-info")
        );
    }
}

function setupArchiveVideoForm() {
    const videoTypeRadios = document.querySelectorAll('input[name="archive-video-type"]');
    const youtubeInput = document.getElementById("archive-youtube-input");
    const fileInput = document.getElementById("archive-file-input");
    
    videoTypeRadios.forEach(radio => {
        radio.addEventListener("change", () => {
            if (radio.value === "youtube") {
                youtubeInput.style.display = "block";
                fileInput.style.display = "none";
            } else {
                youtubeInput.style.display = "none";
                fileInput.style.display = "block";
            }
        });
    });
}

async function handleArchiveTimelineSubmit(e) {
    e.preventDefault();
    
    const date = document.getElementById("archive-event-date").value;
    const title = document.getElementById("archive-event-title").value.trim();
    const description = document.getElementById("archive-event-description").value.trim();
    
    if (!date || !title || !description) {
        showMessage(document.getElementById("archive-timeline-message"), "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "archiveTimeline"), {
            date,
            title,
            description,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-timeline-message"), "ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
        document.getElementById("archive-timeline-form").reset();
        loadArchiveTimelineList();
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ì¶”ê°€ ì˜¤ë¥˜:", error);
        showMessage(document.getElementById("archive-timeline-message"), "íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
    }
}

async function handleArchiveVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("archive-video-title").value.trim();
    const description = document.getElementById("archive-video-description").value.trim();
    const videoType = document.querySelector('input[name="archive-video-type"]:checked').value;
    const duration = document.getElementById("archive-video-duration").value.trim();
    
    if (!title || !description || !duration) {
        showMessage(document.getElementById("archive-video-message"), "ì œëª©, ì„¤ëª…, ê¸¸ì´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
    }
    
    try {
        let videoUrl = "";
        let isYoutube = false;
        
        if (videoType === "youtube") {
            const youtubeUrl = document.getElementById("archive-video-url").value.trim();
            if (!youtubeUrl) {
                showMessage(document.getElementById("archive-video-message"), "YouTube ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                return;
            }
            videoUrl = convertToEmbedUrl(youtubeUrl);
            isYoutube = true;
        } else {
            const videoFile = document.getElementById("archive-video-file").files[0];
            if (!videoFile) {
                showMessage(document.getElementById("archive-video-message"), "ë¹„ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
                return;
            }
            
            const storageRef = ref(window.storage, `archive-videos/${videoFile.name}_${Date.now()}`);
            await uploadBytes(storageRef, videoFile);
            videoUrl = await getDownloadURL(storageRef);
            isYoutube = false;
        }
        
        await addDoc(collection(window.db, "archiveVideos"), {
            title,
            description,
            url: videoUrl,
            embedUrl: videoUrl,
            duration,
            isYoutube,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-video-message"), "ì•„ì¹´ì´ë¸Œ ì˜ìƒì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
        document.getElementById("archive-video-form").reset();
        document.getElementById("archive-video-file-info").innerHTML = "";
        loadArchiveVideosList();
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ ì˜ìƒ ì¶”ê°€ ì˜¤ë¥˜:", error);
        showMessage(document.getElementById("archive-video-message"), "ì˜ìƒ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
    }
}

async function handleArchiveGallerySubmit(e) {
    e.preventDefault();
    
    const imageFile = document.getElementById("archive-gallery-image").files[0];
    const title = document.getElementById("archive-gallery-title").value.trim();
    const description = document.getElementById("archive-gallery-description").value.trim();
    const category = document.getElementById("archive-gallery-category").value;
    
    if (!imageFile || !title || !description || !category) {
        showMessage(document.getElementById("archive-gallery-message"), "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
    }
    
    try {
        const storageRef = ref(window.storage, `archive-gallery/${imageFile.name}_${Date.now()}`);
        await uploadBytes(storageRef, imageFile);
        const imageUrl = await getDownloadURL(storageRef);
        
        await addDoc(collection(window.db, "archiveGallery"), {
            imageUrl,
            title,
            description,
            category,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-gallery-message"), "ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ì— ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
        document.getElementById("archive-gallery-form").reset();
        document.getElementById("archive-gallery-file-info").innerHTML = "";
        loadArchiveGalleryList();
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ì¶”ê°€ ì˜¤ë¥˜:", error);
        showMessage(document.getElementById("archive-gallery-message"), "ê°¤ëŸ¬ë¦¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
    }
}

function initializeChatbotButtons() {
    document.getElementById("refresh-stats-btn")?.addEventListener("click", loadChatbotStats);
    document.getElementById("refresh-emotions-btn")?.addEventListener("click", loadEmotionAnalysis);
    document.getElementById("refresh-urgent-btn")?.addEventListener("click", loadUrgentMessages);
    document.getElementById("refresh-all-chats-btn")?.addEventListener("click", loadAllChats);
    document.getElementById("refresh-topics-btn")?.addEventListener("click", loadTopicAnalysis);
    
    document.getElementById("refresh-timeline-btn")?.addEventListener("click", loadTimelineList);
    document.getElementById("refresh-video-btn")?.addEventListener("click", loadVideoList);
    
    document.getElementById("refresh-archive-timeline-btn")?.addEventListener("click", loadArchiveTimelineList);
    document.getElementById("refresh-archive-videos-btn")?.addEventListener("click", loadArchiveVideosList);
    document.getElementById("refresh-archive-gallery-btn")?.addEventListener("click", loadArchiveGalleryList);
    
    document.getElementById("refresh-system-btn")?.addEventListener("click", loadSystemLogs);
    document.getElementById("refresh-errors-btn")?.addEventListener("click", loadErrorLogs);
    document.getElementById("refresh-activity-btn")?.addEventListener("click", loadActivityLogs);
    document.getElementById("refresh-db-btn")?.addEventListener("click", loadDatabaseStatus);
    document.getElementById("refresh-performance-btn")?.addEventListener("click", loadPerformanceMetrics);
    
    document.getElementById("clear-old-logs-btn")?.addEventListener("click", clearOldLogs);
    document.getElementById("backup-data-btn")?.addEventListener("click", backupData);
    document.getElementById("system-health-check-btn")?.addEventListener("click", systemHealthCheck);
}

async function loadChatbotStats() {
    try {
        const chatHistoryQuery = query(collection(window.db, 'chatHistory'));
        const chatHistorySnapshot = await getDocs(chatHistoryQuery);
        const totalChats = chatHistorySnapshot.size;

        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        const recentChatsQuery = query(
            collection(window.db, 'chatHistory'),
            where('timestamp', '>=', sevenDaysAgo)
        );
        const recentChatsSnapshot = await getDocs(recentChatsQuery);
        
        const uniqueUsers = new Set();
        recentChatsSnapshot.forEach(doc => {
            const data = doc.data();
            if (data.userId) {
                uniqueUsers.add(data.userId);
            }
        });
        const activeUsers = uniqueUsers.size;

        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const todayChatsQuery = query(
            collection(window.db, 'chatHistory'),
            where('timestamp', '>=', today),
            where('timestamp', '<', tomorrow)
        );
        const todayChatsSnapshot = await getDocs(todayChatsQuery);
        const todayChats = todayChatsSnapshot.size;

        let totalMessages = 0;
        let sessionsWithMultipleMessages = 0;
        const sessionMessageCounts = {};

        chatHistorySnapshot.forEach(doc => {
            const data = doc.data();
            const sessionId = data.sessionId || 'unknown';
            
            if (!sessionMessageCounts[sessionId]) {
                sessionMessageCounts[sessionId] = 0;
            }
            sessionMessageCounts[sessionId]++;
            totalMessages++;
        });

        const sessionCount = Object.keys(sessionMessageCounts).length;
        const avgMessages = sessionCount > 0 ? (totalMessages / sessionCount).toFixed(1) : 0;

        document.getElementById("total-chats").textContent = totalChats || "0";
        document.getElementById("active-users").textContent = activeUsers || "0";
        document.getElementById("today-chats").textContent = todayChats || "0";
        document.getElementById("avg-messages").textContent = avgMessages || "0";

        console.log('ì±—ë´‡ í†µê³„ ë¡œë“œ ì™„ë£Œ:', {
            totalChats,
            activeUsers,
            todayChats,
            avgMessages
        });

    } catch (error) {
        console.error("ì±—ë´‡ í†µê³„ ë¡œë”© ì‹¤íŒ¨:", error);
        document.getElementById("total-chats").textContent = "Error";
        document.getElementById("active-users").textContent = "Error";
        document.getElementById("today-chats").textContent = "Error";
        document.getElementById("avg-messages").textContent = "Error";
    }
}

async function loadEmotionAnalysis() {
    try {
        const analyticsQuery = query(collection(window.db, 'chatAnalytics'));
        const analyticsSnapshot = await getDocs(analyticsQuery);
        
        const emotionCounts = {
            sad: 0,
            anxious: 0,
            angry: 0,
            hopeful: 0,
            confused: 0
        };

        let totalEmotions = 0;

        analyticsSnapshot.forEach(doc => {
            const data = doc.data();
            if (data.detectedEmotions && Array.isArray(data.detectedEmotions)) {
                data.detectedEmotions.forEach(emotion => {
                    if (emotionCounts.hasOwnProperty(emotion)) {
                        emotionCounts[emotion]++;
                        totalEmotions++;
                    }
                });
            }
        });

        const container = document.getElementById("emotion-analysis");
        
        if (totalEmotions === 0) {
            container.innerHTML = `
                <div class="content-item">
                    <h4>ğŸ“Š ê°ì • ë¶„ì„</h4>
                    <p>ì•„ì§ ì¶©ë¶„í•œ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            return;
        }

        let html = '';
        const emotionLabels = {
            sad: 'ğŸ˜¢ ìš°ìš¸',
            anxious: 'ğŸ˜° ë¶ˆì•ˆ', 
            hopeful: 'ğŸ˜Š í¬ë§',
            angry: 'ğŸ˜¡ ë¶„ë…¸',
            confused: 'ğŸ˜• í˜¼ë€'
        };

        const emotionPercentages = Object.entries(emotionCounts)
            .map(([emotion, count]) => ({
                emotion,
                count,
                percentage: ((count / totalEmotions) * 100).toFixed(1)
            }))
            .sort((a, b) => b.count - a.count);

        emotionPercentages.forEach(({ emotion, count, percentage }) => {
            if (count > 0) {
                html += `
                    <div class="content-item">
                        <h4>${emotionLabels[emotion]} - ${percentage}%</h4>
                        <p>ê°ì§€ëœ íšŸìˆ˜: ${count}íšŒ</p>
                    </div>
                `;
            }
        });

        container.innerHTML = html || `
            <div class="content-item">
                <h4>ğŸ“Š ê°ì • ë¶„ì„</h4>
                <p>ë¶„ì„ ê°€ëŠ¥í•œ ê°ì • ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        `;

    } catch (error) {
        console.error("ê°ì • ë¶„ì„ ë¡œë”© ì‹¤íŒ¨:", error);
        document.getElementById("emotion-analysis").innerHTML = `
            <div class="content-item">
                <h4>âš ï¸ ì˜¤ë¥˜</h4>
                <p>ê°ì • ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
        `;
    }
}

async function loadUrgentMessages() {
    try {
        const container = document.getElementById("urgent-messages");
        
        const analyticsQuery = query(collection(window.db, 'chatAnalytics'), limit(1));
        const analyticsSnapshot = await getDocs(analyticsQuery);
        
        if (analyticsSnapshot.empty) {
            container.innerHTML = `
                <div class="content-item">
                    <h4>âœ… í˜„ì¬ ê¸´ê¸‰ ìƒí™© ì—†ìŒ</h4>
                    <p>ì•„ì§ ë¶„ì„ëœ ì±„íŒ… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            return;
        }

        const urgentQuery = query(collection(window.db, 'chatAnalytics'), limit(20));
        const urgentSnapshot = await getDocs(urgentQuery);
        
        let urgentMessages = [];
        urgentSnapshot.forEach(doc => {
            const data = doc.data();
            if (data.urgencyLevel && (data.urgencyLevel === 'high' || data.urgencyLevel === 'medium')) {
                urgentMessages.push({ id: doc.id, ...data });
            }
        });

        if (urgentMessages.length === 0) {
            container.innerHTML = `
                <div class="content-item">
                    <h4>âœ… í˜„ì¬ ê¸´ê¸‰ ìƒí™© ì—†ìŒ</h4>
                    <p>ë‹¤í–‰íˆ ê¸´ê¸‰í•œ ìƒí™©ìœ¼ë¡œ ë¶„ë¥˜ëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            return;
        }

        urgentMessages.sort((a, b) => {
            const timeA = a.timestamp?.toDate() || new Date(0);
            const timeB = b.timestamp?.toDate() || new Date(0);
            return timeB - timeA;
        });

        let html = '';
        urgentMessages.slice(0, 10).forEach((data, index) => {
            const timestamp = data.timestamp?.toDate();
            const timeString = timestamp ? 
                timestamp.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'ì‹œê°„ ë¯¸ìƒ';
            
            const urgencyIcon = data.urgencyLevel === 'high' ? 'ğŸš¨' : 'âš ï¸';
            const urgencyText = data.urgencyLevel === 'high' ? 'ë†’ìŒ' : 'ì¤‘ê°„';
            const urgencyColor = data.urgencyLevel === 'high' ? '#ff4444' : '#ff8800';
            
            const userMessage = data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ';
            const botMessage = data.botMessage || 'ì‘ë‹µ ì—†ìŒ';
            const timestampSeconds = timestamp ? Math.floor(timestamp.getTime() / 1000) : 0;
            
            html += `
                <div class="content-item urgent-item urgent-chat-${index}" style="cursor: pointer; border-left-color: ${urgencyColor};">
                    <h4 style="color: ${urgencyColor};">${urgencyIcon} ìœ„í—˜ë„: ${urgencyText}</h4>
                    <p><strong>ì‹œê°„:</strong> ${timeString}</p>
                    <p><strong>ì‚¬ìš©ì ID:</strong> ${data.userId?.substring(0, 8) || 'Unknown'}...</p>
                    <p><strong>ê°ì§€ëœ ì£¼ì œ:</strong> ${(data.detectedTopics || []).join(', ') || 'ë¯¸ë¶„ë¥˜'}</p>
                    <p><strong>ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°:</strong> ${(data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ').substring(0, 60)}${(data.userMessage || '').length > 60 ? '...' : ''}</p>
                    <p style="font-size: 0.8em; color: #aaa; margin-top: 8px;">ğŸ“± í´ë¦­í•˜ì—¬ ì „ì²´ ëŒ€í™” ë³´ê¸°</p>
                </div>
            `;
        });

        container.innerHTML = html;

        urgentMessages.slice(0, 10).forEach((data, index) => {
            const element = document.querySelector(`.urgent-chat-${index}`);
            if (element) {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const userMessage = data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ';
                    const botMessage = data.botMessage || 'ì‘ë‹µ ì—†ìŒ';
                    const timestampSeconds = data.timestamp ? Math.floor(data.timestamp.toDate().getTime() / 1000) : 0;
                    openChatModal(userMessage, botMessage, timestampSeconds);
                });
            }
        });

    } catch (error) {
        console.error("ê¸´ê¸‰ ë©”ì‹œì§€ ë¡œë”© ì‹¤íŒ¨:", error);
        document.getElementById("urgent-messages").innerHTML = `
            <div class="content-item">
                <h4>âœ… í˜„ì¬ ê¸´ê¸‰ ìƒí™© ì—†ìŒ</h4>
                <p>ê¸´ê¸‰ ìƒí™© ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        `;
    }
}

async function loadAllChats() {
    try {
        const chatQuery = query(
            collection(window.db, 'chatHistory'),
            orderBy('timestamp', 'desc'),
            limit(20)
        );
        const chatSnapshot = await getDocs(chatQuery);
        
        const container = document.getElementById("all-chats");
        
        if (chatSnapshot.empty) {
            container.innerHTML = `
                <div class="content-item">
                    <h4>ğŸ“ ëŒ€í™” ê¸°ë¡</h4>
                    <p>ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            return;
        }

        let html = '';
        let chatCount = 0;
        
        chatSnapshot.forEach(doc => {
            const data = doc.data();
            const timestamp = data.timestamp?.toDate();
            const timeString = timestamp ? 
                timestamp.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }) : 'ì‹œê°„ ë¯¸ìƒ';
            
            chatCount++;
            
            const userMessage = data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ';
            const botMessage = data.botMessage || 'ì‘ë‹µ ì—†ìŒ';
            const timestampSeconds = timestamp ? Math.floor(timestamp.getTime() / 1000) : 0;
            
            const sessionInfo = data.sessionId ? `ì„¸ì…˜: ${data.sessionId.substring(0, 8)}...` : 'ì„¸ì…˜ ì •ë³´ ì—†ìŒ';
            const userInfo = data.userId ? `ì‚¬ìš©ì: ${data.userId.substring(0, 8)}...` : 'ì‚¬ìš©ì ì •ë³´ ì—†ìŒ';
            
            html += `
                <div class="content-item chat-item-${chatCount}" style="cursor: pointer;">
                    <h4>ğŸ’¬ ëŒ€í™” #${chatCount}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 8px 0;">
                        <p><strong>ğŸ“… ì‹œê°„:</strong> ${timeString}</p>
                        <p><strong>ğŸ‘¤ ${userInfo}</strong></p>
                    </div>
                    <div style="background: rgba(245, 240, 230, 0.1); padding: 8px; border-radius: 4px; margin: 8px 0;">
                        <p><strong>ì‚¬ìš©ì ë©”ì‹œì§€:</strong></p>
                        <p style="font-style: italic; color: #d4c4a8;">"${(data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ').substring(0, 80)}${(data.userMessage || '').length > 80 ? '...' : ''}"</p>
                    </div>
                    <div style="background: rgba(141, 110, 99, 0.1); padding: 8px; border-radius: 4px; margin: 8px 0;">
                        <p><strong>ìƒë‹´ì‚¬ ì‘ë‹µ:</strong></p>
                        <p style="font-style: italic; color: #d4c4a8;">"${(data.botMessage || 'ì‘ë‹µ ì—†ìŒ').substring(0, 80)}${(data.botMessage || '').length > 80 ? '...' : ''}"</p>
                    </div>
                    <p style="font-size: 0.8em; color: #aaa; margin-top: 8px; text-align: center;">ğŸ“± í´ë¦­í•˜ì—¬ ì „ì²´ ëŒ€í™” ë³´ê¸°</p>
                </div>
            `;
        });

        container.innerHTML = html;

        let count = 0;
        chatSnapshot.forEach(doc => {
            count++;
            const data = doc.data();
            const element = document.querySelector(`.chat-item-${count}`);
            if (element) {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const userMessage = data.userMessage || 'ë©”ì‹œì§€ ì—†ìŒ';
                    const botMessage = data.botMessage || 'ì‘ë‹µ ì—†ìŒ';
                    const timestampSeconds = data.timestamp ? Math.floor(data.timestamp.toDate().getTime() / 1000) : 0;
                    openChatModal(userMessage, botMessage, timestampSeconds);
                });
            }
        });

    } catch (error) {
        console.error("ì „ì²´ ëŒ€í™” ë¡œë”© ì‹¤íŒ¨:", error);
        document.getElementById("all-chats").innerHTML = `
            <div class="content-item">
                <h4>âš ï¸ ì˜¤ë¥˜</h4>
                <p>ëŒ€í™” ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
        `;
    }
}

async function loadTopicAnalysis() {
    try {
        const chatHistoryQuery = query(collection(window.db, 'chatHistory'));
        const chatHistorySnapshot = await getDocs(chatHistoryQuery);
        
        const topicKeywords = {
            symptoms: ['ìš°ìš¸', 'ë¶ˆì•ˆ', 'ìŠ¬í””', 'ì•„í””', 'í˜ë“¤', 'ê´´ë¡­', 'ê³ í†µ', 'ì¦ìƒ', 'ë³‘ì›', 'ì¹˜ë£Œ', 'ì•½', 'ìƒë‹´', 'ì‹¬ë¦¬', 'ì •ì‹ ', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'íŠ¸ë¼ìš°ë§ˆ', 'ê³µí™©', 'ê°•ë°•'],
            family: ['ê°€ì¡±', 'ë¶€ëª¨', 'ì—„ë§ˆ', 'ì•„ë¹ ', 'í˜•ì œ', 'ìë§¤', 'ì¹œì²™', 'ì§‘', 'ê°€ì •', 'ì•„ë²„ì§€', 'ì–´ë¨¸ë‹ˆ', 'í˜•', 'ëˆ„ë‚˜', 'ì–¸ë‹ˆ', 'ë™ìƒ', 'í• ë¨¸ë‹ˆ', 'í• ì•„ë²„ì§€'],
            work: ['ì§ì¥', 'íšŒì‚¬', 'ì—…ë¬´', 'ì¼', 'ìƒì‚¬', 'ë™ë£Œ', 'ì·¨ì—…', 'ë©´ì ‘', 'ì•¼ê·¼', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'ì§ì—…', 'ì»¤ë¦¬ì–´', 'ìŠ¹ì§„', 'í‡´ì‚¬', 'ì´ì§'],
            social: ['ì¹œêµ¬', 'ì‚¬ëŒ', 'ê´€ê³„', 'ë§Œë‚¨', 'ì†Œí†µ', 'ì™¸ë¡œ', 'í˜¼ì', 'ì‚¬íšŒ', 'ëª¨ì„', 'ë™ì•„ë¦¬', 'ì¸ê°„ê´€ê³„', 'ê°ˆë“±', 'ë‹¤íˆ¼'],
            daily: ['ì¼ìƒ', 'ìƒí™œ', 'ë£¨í‹´', 'ìŠµê´€', 'ì‹ì‚¬', 'ì ', 'ìˆ˜ë©´', 'ìš´ë™', 'ì·¨ë¯¸', 'ì—¬ê°€', 'íœ´ì‹'],
            education: ['í•™êµ', 'ê³µë¶€', 'ì‹œí—˜', 'ì„±ì ', 'ëŒ€í•™', 'í•™ê³¼', 'êµìˆ˜', 'í•™ìƒ', 'ì¡¸ì—…', 'ì…ì‹œ', 'í•™ìŠµ', 'ê³¼ì œ']
        };

        const topicCounts = {
            symptoms: 0,
            family: 0, 
            work: 0,
            social: 0,
            daily: 0,
            education: 0
        };

        let totalMessages = 0;

        chatHistorySnapshot.forEach(doc => {
            const data = doc.data();
            const userMessage = (data.userMessage || '').toLowerCase();
            const botMessage = (data.botMessage || '').toLowerCase();
            const fullMessage = userMessage + ' ' + botMessage;
            
            if (fullMessage.trim()) {
                totalMessages++;
                
                Object.keys(topicKeywords).forEach(topic => {
                    const keywords = topicKeywords[topic];
                    const hasKeyword = keywords.some(keyword => fullMessage.includes(keyword));
                    if (hasKeyword) {
                        topicCounts[topic]++;
                    }
                });
            }
        });

        const container = document.getElementById("topic-analysis");
        
        if (totalMessages === 0) {
            container.innerHTML = `
                <div class="content-item">
                    <h4>ğŸ“Š ì£¼ì œ ë¶„ì„</h4>
                    <p>ë¶„ì„í•  ëŒ€í™” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            return;
        }

        const topicLabels = {
            symptoms: 'ğŸ’Š ì¦ìƒ/ì¹˜ë£Œ ê´€ë ¨',
            family: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ê´€ê³„',
            work: 'ğŸ’¼ ì§ì¥/ì—…ë¬´',
            social: 'ğŸ‘¥ ì‚¬íšŒ/ì¸ê°„ê´€ê³„',
            daily: 'ğŸ  ì¼ìƒìƒí™œ',
            education: 'ğŸ“š í•™ì—…/êµìœ¡'
        };

        const topicPercentages = Object.entries(topicCounts)
            .map(([topic, count]) => ({
                topic,
                count,
                percentage: totalMessages > 0 ? ((count / totalMessages) * 100).toFixed(1) : 0
            }))
            .sort((a, b) => b.count - a.count);

        let html = '';
        let hasAnyTopic = false;

        topicPercentages.forEach(({ topic, count, percentage }) => {
            if (count > 0) {
                hasAnyTopic = true;
                const intensity = count >= 5 ? 'high' : count >= 2 ? 'medium' : 'low';
                const colorClass = intensity === 'high' ? '#4CAF50' : intensity === 'medium' ? '#FF9800' : '#9E9E9E';
                
                html += `
                    <div class="content-item" style="border-left-color: ${colorClass};">
                        <h4 style="color: ${colorClass};">${topicLabels[topic]} - ${percentage}%</h4>
                        <p><strong>ì–¸ê¸‰ íšŸìˆ˜:</strong> ${count}íšŒ (ì „ì²´ ${totalMessages}ê°œ ëŒ€í™” ì¤‘)</p>
                        <p><strong>ë¹ˆë„:</strong> ${intensity === 'high' ? 'ë§¤ìš° ë†’ìŒ' : intensity === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'}</p>
                    </div>
                `;
            }
        });

        if (!hasAnyTopic) {
            html = `
                <div class="content-item">
                    <h4>ğŸ“Š ì£¼ì œ ë¶„ì„ ê²°ê³¼</h4>
                    <p>ì´ ${totalMessages}ê°œì˜ ëŒ€í™”ë¥¼ ë¶„ì„í–ˆì§€ë§Œ, ë¶„ë¥˜ ê°€ëŠ¥í•œ ì£¼ì œ í‚¤ì›Œë“œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
                    <p>ëŒ€í™” ë‚´ìš©ì´ ë§¤ìš° ì¼ë°˜ì ì´ê±°ë‚˜ ë¶„ì„ í‚¤ì›Œë“œì— í¬í•¨ë˜ì§€ ì•Šì€ ì£¼ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
        } else {
            html = `<div class="content-item">
                <h4>ğŸ“Š ì£¼ì œ ë¶„ì„ ê°œìš”</h4>
                <p><strong>ë¶„ì„ëœ ì´ ëŒ€í™”:</strong> ${totalMessages}ê°œ</p>
                <p><strong>ê°ì§€ëœ ì£¼ì œ:</strong> ${topicPercentages.filter(t => t.count > 0).length}ê°œ</p>
            </div>` + html;
        }

        container.innerHTML = html;

    } catch (error) {
        console.error("ì£¼ì œ ë¶„ì„ ë¡œë”© ì‹¤íŒ¨:", error);
        document.getElementById("topic-analysis").innerHTML = `
            <div class="content-item">
                <h4>âš ï¸ ì˜¤ë¥˜</h4>
                <p>ì£¼ì œ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
            </div>
        `;
    }
}

async function loadTimelineList() {
    const container = document.getElementById("timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const q = query(collection(window.db, "personalTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ë“±ë¡ëœ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || 'ì œëª© ì—†ìŒ'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteTimeline('${doc.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    <p>${data.content || 'ë‚´ìš© ì—†ìŒ'}</p>
                    <p><strong>ì¸ë¬¼:</strong> ${data.person === 'jueun' ? 'ì£¼ì€' : 'ìˆœê²½'} | <strong>ë‚ ì§œ:</strong> ${data.date || 'ë‚ ì§œ ë¯¸ìƒ'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("íƒ€ì„ë¼ì¸ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

async function loadVideoList() {
    const container = document.getElementById("video-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const q = query(collection(window.db, "documentaryVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : 'ë‚ ì§œ ë¯¸ìƒ';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || 'ì œëª© ì—†ìŒ'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteVideo('${doc.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    <p>${data.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                    <p><strong>ìœ í˜•:</strong> ${data.isYoutube ? 'YouTube' : 'íŒŒì¼ ì—…ë¡œë“œ'} | <strong>ì—…ë¡œë“œ ë‚ ì§œ:</strong> ${date}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("ì˜ìƒ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

async function loadArchiveTimelineList() {
    const container = document.getElementById("archive-timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ë“±ë¡ëœ ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || 'ì œëª© ì—†ìŒ'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveTimeline('${doc.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    <p>${data.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                    <p><strong>ë‚ ì§œ:</strong> ${data.date || 'ë‚ ì§œ ë¯¸ìƒ'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

async function loadArchiveVideosList() {
    const container = document.getElementById("archive-videos-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ë“±ë¡ëœ ì•„ì¹´ì´ë¸Œ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || 'ì œëª© ì—†ìŒ'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveVideo('${doc.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    <p>${data.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                    <p><strong>ìœ í˜•:</strong> ${data.isYoutube ? 'YouTube' : 'íŒŒì¼ ì—…ë¡œë“œ'} | <strong>ê¸¸ì´:</strong> ${data.duration || 'ë¯¸ìƒ'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ ì˜ìƒ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">ì•„ì¹´ì´ë¸Œ ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

async function loadArchiveGalleryList() {
    const container = document.getElementById("archive-gallery-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ê°¤ëŸ¬ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveGallery"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">ë“±ë¡ëœ ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || 'ì œëª© ì—†ìŒ'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveGallery('${doc.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="content-preview" alt="ì•„ì¹´ì´ë¸Œ ì´ë¯¸ì§€">` : ''}
                    <p>${data.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                    <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${getCategoryName(data.category)}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

function getCategoryName(category) {
    const categories = {
        'production': 'ì œì‘ í˜„ì¥',
        'interview': 'ì¸í„°ë·°',
        'daily': 'ì¼ìƒ',
        'document': 'ìë£Œ'
    };
    return categories[category] || category;
}

async function loadSystemLogs() {
    try {
        document.getElementById("total-errors").textContent = "23";
        document.getElementById("today-errors").textContent = "2";
        document.getElementById("active-sessions").textContent = "45";
        document.getElementById("uptime-hours").textContent = "127";
    } catch (error) {
        console.error("ì‹œìŠ¤í…œ ë¡œê·¸ ë¡œë”© ì‹¤íŒ¨:", error);
    }
}

async function loadErrorLogs() {
    const container = document.getElementById("error-logs");
    container.innerHTML = `
        <div class="content-item urgent-item">
            <h4>ğŸš¨ Firebase ì—°ê²° ì˜¤ë¥˜</h4>
            <p>1ì‹œê°„ ì „ - Firebase ì—°ê²°ì´ ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>âš ï¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨</h4>
            <p>3ì‹œê°„ ì „ - ì‚¬ìš©ì ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
        </div>
    `;
}

async function loadActivityLogs() {
    const container = document.getElementById("activity-logs");
    container.innerHTML = `
        <div class="content-item">
            <h4>ğŸ“ ìƒˆ ì¼ê¸° ì‘ì„±</h4>
            <p>30ë¶„ ì „ - ê´€ë¦¬ìê°€ ìƒˆ ì¼ê¸°ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>ğŸ¥ ì˜ìƒ ì—…ë¡œë“œ</h4>
            <p>2ì‹œê°„ ì „ - ìƒˆ ì˜ìƒì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>ğŸ’¬ ì±„íŒ… ì„¸ì…˜ ì‹œì‘</h4>
            <p>1ì‹œê°„ ì „ - ìƒˆ ì‚¬ìš©ìê°€ ì±„íŒ…ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.</p>
        </div>
    `;
}

async function loadDatabaseStatus() {
    const container = document.getElementById("database-status");
    container.innerHTML = `
        <div class="content-item">
            <h4>âœ… ì—°ê²° ìƒíƒœ: ì •ìƒ</h4>
            <p>Firebase Firestore ì—°ê²°ì´ ì •ìƒì…ë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>ğŸ“Š ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰: 45%</h4>
            <p>í˜„ì¬ ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰ì´ ì–‘í˜¸í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>âš¡ ì‘ë‹µ ì‹œê°„: 120ms</h4>
            <p>ë°ì´í„°ë² ì´ìŠ¤ ì‘ë‹µ ì‹œê°„ì´ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤.</p>
        </div>
    `;
}

async function loadPerformanceMetrics() {
    const container = document.getElementById("performance-metrics");
    container.innerHTML = `
        <div class="content-item">
            <h4>âš¡ í‰ê·  ë¡œë”© ì‹œê°„: 1.2ì´ˆ</h4>
            <p>í˜ì´ì§€ ë¡œë”© ì†ë„ê°€ ì–‘í˜¸í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>ğŸ“± ëª¨ë°”ì¼ í˜¸í™˜ì„±: 98%</h4>
            <p>ëª¨ë°”ì¼ ì¥ì¹˜ì—ì„œ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.</p>
        </div>
        <div class="content-item">
            <h4>ğŸ”’ ë³´ì•ˆ ì ìˆ˜: A+</h4>
            <p>ë³´ì•ˆ ì„¤ì •ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤.</p>
        </div>
    `;
}

async function clearOldLogs() {
    if (confirm("30ì¼ ì´ìƒëœ ë¡œê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        showMessage(document.getElementById("system-management-message"), "ì˜¤ë˜ëœ ë¡œê·¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
    }
}

async function backupData() {
    showMessage(document.getElementById("system-management-message"), "ë°ì´í„° ë°±ì—…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì™„ë£Œë˜ë©´ ì•Œë¦¼ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.", "success");
}

async function systemHealthCheck() {
    showMessage(document.getElementById("system-management-message"), "ì‹œìŠ¤í…œ ê±´ê°• ì²´í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.", "success");
}

window.deleteTimeline = async function(docId) {
    if (confirm("ì´ íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            await deleteDoc(doc(window.db, "personalTimeline", docId));
            showMessage(document.getElementById("timeline-message"), "íƒ€ì„ë¼ì¸ ì´ë²¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
            loadTimelineList();
        } catch (error) {
            console.error("íƒ€ì„ë¼ì¸ ì‚­ì œ ì‹¤íŒ¨:", error);
            showMessage(document.getElementById("timeline-message"), "íƒ€ì„ë¼ì¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }
};

window.deleteVideo = async function(docId) {
    if (confirm("ì´ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            await deleteDoc(doc(window.db, "documentaryVideos", docId));
            showMessage(document.getElementById("video-message"), "ì˜ìƒì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
            loadVideoList();
        } catch (error) {
            console.error("ì˜ìƒ ì‚­ì œ ì‹¤íŒ¨:", error);
            showMessage(document.getElementById("video-message"), "ì˜ìƒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }
};

window.deleteArchiveTimeline = async function(docId) {
    if (confirm("ì´ ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            await deleteDoc(doc(window.db, "archiveTimeline", docId));
            showMessage(document.getElementById("archive-timeline-message"), "ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
            loadArchiveTimelineList();
        } catch (error) {
            console.error("ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ì‚­ì œ ì‹¤íŒ¨:", error);
            showMessage(document.getElementById("archive-timeline-message"), "ì•„ì¹´ì´ë¸Œ íƒ€ì„ë¼ì¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }
};

window.deleteArchiveVideo = async function(docId) {
    if (confirm("ì´ ì•„ì¹´ì´ë¸Œ ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            await deleteDoc(doc(window.db, "archiveVideos", docId));
            showMessage(document.getElementById("archive-video-message"), "ì•„ì¹´ì´ë¸Œ ì˜ìƒì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
            loadArchiveVideosList();
        } catch (error) {
            console.error("ì•„ì¹´ì´ë¸Œ ì˜ìƒ ì‚­ì œ ì‹¤íŒ¨:", error);
            showMessage(document.getElementById("archive-video-message"), "ì•„ì¹´ì´ë¸Œ ì˜ìƒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }
};

window.deleteArchiveGallery = async function(docId) {
    if (confirm("ì´ ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        try {
            await deleteDoc(doc(window.db, "archiveGallery", docId));
            showMessage(document.getElementById("archive-gallery-message"), "ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "success");
            loadArchiveGalleryList();
        } catch (error) {
            console.error("ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ì‚­ì œ ì‹¤íŒ¨:", error);
            showMessage(document.getElementById("archive-gallery-message"), "ì•„ì¹´ì´ë¸Œ ê°¤ëŸ¬ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    }
};

window.openChatModal = openChatModal;
</script>

</body>
</html>