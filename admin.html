async function handleVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("video-title").value.trim();
    const description = document.getElementById("video-description").value.trim();
    const videoType = document.querySelector('input[name="video-type"]:checked').value;
    
    if (!title) {
        showMessage(document.getElementById("video-message"), "영상 제목을 입력해주세요.", "error");
        return;
    }
    
    try {
        let videoUrl = "";
        let isYoutube = false;
        
        if (videoType === "youtube") {
            const youtubeUrl = document.getElementById("youtube-url").value.trim();
            if (!youtubeUrl) {
                showMessage(document.getElementById("video-message"), "YouTube 링크를 입력해주세요.", "error");
                return;
            }
            videoUrl = convertToEmbedUrl(youtubeUrl);
            isYoutube = true;
        } else {
            const videoFile = document.getElementById("video-file").files[0];
            if (!videoFile) {
                showMessage(document.getElementById("video-message"), "비디오 파일을 선택해주세요.", "error");
                return;
            }
            
            const storageRef = ref(window.storage, `videos/${videoFile.name}_${Date.now()}`);
            await uploadBytes(storageRef, videoFile);
            videoUrl = await getDownloadURL(storageRef);
            isYoutube = false;
        }
        
        await addDoc(collection(window.db, "documentaryVideos"), {
            title,
            description,
            videoUrl,
            isYoutube,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("video-message"), "영상이 성공적으로 업로드되었습니다!", "success");
        document.getElementById("video-form").reset();
        document.getElementById("video-file-info").innerHTML = "";
        loadVideoList();
    } catch (error) {
        console.error("영상 업로드 오류:", error);
        showMessage(document.getElementById("video-message"), "영상 업로드 중 오류가 발생했습니다.", "error");
    }
}

function initializeArchiveForms() {
    const archiveTimelineForm = document.getElementById("archive-timeline-form");
    if (archiveTimelineForm) {
        archiveTimelineForm.addEventListener("submit", handleArchiveTimelineSubmit);
    }
    
    const archiveVideoForm = document.getElementById("archive-video-form");
    if (archiveVideoForm) {
        archiveVideoForm.addEventListener("submit", handleArchiveVideoSubmit);
    }
    
    const archiveGalleryForm = document.getElementById("archive-gallery-form");
    if (archiveGalleryForm) {
        archiveGalleryForm.addEventListener("submit", handleArchiveGallerySubmit);
        displayFileInfo(
            document.getElementById("archive-gallery-image"),
            document.getElementById("archive-gallery-file-info")
        );
    }
}

async function handleArchiveTimelineSubmit(e) {
    e.preventDefault();
    
    const date = document.getElementById("archive-event-date").value;
    const title = document.getElementById("archive-event-title").value.trim();
    const description = document.getElementById("archive-event-description").value.trim();
    
    if (!date || !title || !description) {
        showMessage(document.getElementById("archive-timeline-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "archiveTimeline"), {
            date,
            title,
            description,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인 이벤트가 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-timeline-form").reset();
        loadArchiveTimelineList();
    } catch (error) {
        console.error("아카이브 타임라인 추가 오류:", error);
        showMessage(document.getElementById("archive-timeline-message"), "타임라인 이벤트 추가 중 오류가 발생했습니다.", "error");
    }
}

async function handleArchiveVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("archive-video-title").value.trim();
    const description = document.getElementById("archive-video-description").value.trim();
    const url = document.getElementById("archive-video-url").value.trim();
    const duration = document.getElementById("archive-video-duration").value.trim();
    
    if (!title || !description || !url || !duration) {
        showMessage(document.getElementById("archive-video-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        const embedUrl = convertToEmbedUrl(url);
        
        await addDoc(collection(window.db, "archiveVideos"), {
            title,
            description,
            url: embedUrl,
            duration,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-video-message"), "아카이브 영상이 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-video-form").reset();
        loadArchiveVideosList();
    } catch (error) {
        console.error("아카이브 영상 추가 오류:", error);
        showMessage(document.getElementById("archive-video-message"), "영상 추가 중 오류가 발생했습니다.", "error");
    }
}

async function handleArchiveGallerySubmit(e) {
    e.preventDefault();
    
    const imageFile = document.getElementById("archive-gallery-image").files[0];
    const title = document.getElementById("archive-gallery-title").value.trim();
    const description = document.getElementById("archive-gallery-description").value.trim();
    const category = document.getElementById("archive-gallery-category").value;
    
    if (!imageFile || !title || !description || !category) {
        showMessage(document.getElementById("archive-gallery-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        const storageRef = ref(window.storage, `archive-gallery/${imageFile.name}_${Date.now()}`);
        await uploadBytes(storageRef, imageFile);
        const imageUrl = await getDownloadURL(storageRef);
        
        await addDoc(collection(window.db, "archiveGallery"), {
            imageUrl,
            title,
            description,
            category,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리에 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-gallery-form").reset();
        document.getElementById("archive-gallery-file-info").innerHTML = "";
        loadArchiveGalleryList();
    } catch (error) {
        console.error("아카이브 갤러리 추가 오류:", error);
        showMessage(document.getElementById("archive-gallery-message"), "갤러리 추가 중 오류가 발생했습니다.", "error");
    }
}

function initializeChatbotButtons() {
    document.getElementById("refresh-stats-btn")?.addEventListener("click", loadChatbotStats);
    document.getElementById("refresh-emotions-btn")?.addEventListener("click", loadEmotionAnalysis);
    document.getElementById("refresh-urgent-btn")?.addEventListener("click", loadUrgentMessages);
    document.getElementById("refresh-all-chats-btn")?.addEventListener("click", loadAllChats);
    document.getElementById("refresh-topics-btn")?.addEventListener("click", loadTopicAnalysis);
    
    document.getElementById("refresh-diary-btn")?.addEventListener("click", loadDiaryList);
    
    document.getElementById("refresh-timeline-btn")?.addEventListener("click", loadTimelineList);
    
    document.getElementById("refresh-gallery-btn")?.addEventListener("click", loadGalleryList);
    
    document.getElementById("refresh-video-btn")?.addEventListener("click", loadVideoList);
    
    document.getElementById("refresh-archive-timeline-btn")?.addEventListener("click", loadArchiveTimelineList);
    document.getElementById("refresh-archive-videos-btn")?.addEventListener("click", loadArchiveVideosList);
    document.getElementById("refresh-archive-gallery-btn")?.addEventListener("click", loadArchiveGalleryList);
    
    document.getElementById("refresh-system-btn")?.addEventListener("click", loadSystemLogs);
    document.getElementById("refresh-errors-btn")?.addEventListener("click", loadErrorLogs);
    document.getElementById("refresh-activity-btn")?.addEventListener("click", loadActivityLogs);
    document.getElementById("refresh-db-btn")?.addEventListener("click", loadDatabaseStatus);
    document.getElementById("refresh-performance-btn")?.addEventListener("click", loadPerformanceMetrics);
    
    document.getElementById("clear-old-logs-btn")?.addEventListener("click", clearOldLogs);
    document.getElementById("backup-data-btn")?.addEventListener("click", backupData);
    document.getElementById("system-health-check-btn")?.addEventListener("click", systemHealthCheck);
}

async function loadChatbotStats() {
    try {
        document.getElementById("total-chats").textContent = "127";
        document.getElementById("active-users").textContent = "34";
        document.getElementById("today-chats").textContent = "12";
        document.getElementById("avg-messages").textContent = "8.5";
    } catch (error) {
        console.error("챗봇 통계 로딩 실패:", error);
    }
}

async function loadEmotionAnalysis() {
    const container = document.getElementById("emotion-analysis");
    container.innerHTML = `
        <div class="content-item">
            <h4>😢 우울 - 32%</h4>
            <p>가장 많이 감지된 감정</p>
        </div>
        <div class="content-item">
            <h4>😰 불안 - 28%</h4>
            <p>두 번째로 많은 감정</p>
        </div>
        <div class="content-item">
            <h4>😊 긍정 - 25%</h4>
            <p>긍정적인 감정 표현</p>
        </div>
        <div class="content-item">
            <h4>😡 분노 - 15%</h4>
            <p>가장 적게 감지된 감정</p>
        </div>
    `;
}

async function loadUrgentMessages() {
    const container = document.getElementById("urgent-messages");
    container.innerHTML = `
        <div class="content-item urgent-item">
            <h4>⚠️ 자해 언급 감지</h4>
            <p>2시간 전 - 사용자가 자해에 대한 언급을 했습니다.</p>
        </div>
        <div class="content-item urgent-item">
            <h4>🆘 극도의 우울감 표현</h4>
            <p>6시간 전 - 매우 높은 수준의 우울감이 감지되었습니다.</p>
        </div>
    `;
}

async function loadAllChats() {
    const container = document.getElementById("all-chats");
    container.innerHTML = `
        <div class="content-item" onclick="showChatDetail('오늘 정말 힘든 하루였어요...', '많이 힘드셨군요. 어떤 일이 있었는지 이야기해주실 수 있나요?', 1672531200)">
            <h4>💬 대화 #127</h4>
            <p>2시간 전 - 클릭하여 전체 대화 보기</p>
        </div>
        <div class="content-item" onclick="showChatDetail('계속 불안해요...', '불안감을 느끼고 계시는군요. 구체적으로 어떤 상황에서 불안을 느끼시나요?', 1672527600)">
            <h4>💬 대화 #126</h4>
            <p>4시간 전 - 클릭하여 전체 대화 보기</p>
        </div>
    `;
}

async function loadTopicAnalysis() {
    const container = document.getElementById("topic-analysis");
    container.innerHTML = `
        <div class="content-item">
            <h4>📚 학업 스트레스 - 35%</h4>
            <p>가장 많이 언급된 주제</p>
        </div>
        <div class="content-item">
            <h4>👨‍👩‍👧‍👦 가족 관계 - 28%</h4>
            <p>두 번째로 많은 주제</p>
        </div>
        <div class="content-item">
            <h4>💼 취업 고민 - 22%</h4>
            <p>세 번째로 많은 주제</p>
        </div>
        <div class="content-item">
            <h4>❤️ 연애 관계 - 15%</h4>
            <p>상대적으로 적은 주제</p>
        </div>
    `;
}

async function loadDiaryList() {
    const container = document.getElementById("diary-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">일기 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "diaryPosts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 일기가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteDiary('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.content ? data.content.substring(0, 100) + (data.content.length > 100 ? '...' : '') : '내용 없음'}</p>
                    <p><strong>작성자:</strong> ${data.author || '알 수 없음'} | <strong>날짜:</strong> ${date} | <strong>공개:</strong> ${data.isPublic ? '공개' : '비공개'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("일기 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">일기 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadTimelineList() {
    const container = document.getElementById("timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "personalTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 타임라인 이벤트가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteTimeline('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.content || '내용 없음'}</p>
                    <p><strong>인물:</strong> ${data.person === 'jueun' ? '주은' : '순경'} | <strong>날짜:</strong> ${data.date || '날짜 미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("타임라인 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">타임라인 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadGalleryList() {
    const container = document.getElementById("gallery-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "galleryPosts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 사진이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>📸 갤러리 사진</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteGallery('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="content-preview" alt="갤러리 이미지">` : ''}
                    <p>${data.caption || '설명 없음'}</p>
                    <p><strong>업로드 날짜:</strong> ${date}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("갤러리 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">갤러리 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadVideoList() {
    const container = document.getElementById("video-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "documentaryVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 영상이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteVideo('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>유형:</strong> ${data.isYoutube ? 'YouTube' : '파일 업로드'} | <strong>업로드 날짜:</strong> ${date}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("영상 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">영상 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveTimelineList() {
    const container = document.getElementById("archive-timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 타임라인이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveTimeline('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>날짜:</strong> ${data.date || '날짜 미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("아카이브 타임라인 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 타임라인 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveVideosList() {
    const container = document.getElementById("archive-videos-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 영상이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveVideo('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>길이:</strong> ${data.duration || '미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("아카이브 영상 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 영상 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveGalleryList() {
    const container = document.getElementById("archive-gallery-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveGallery"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 갤러리가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveGallery('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="content-preview" alt="아카이브 이미지">` : ''}
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>카테고리:</strong> ${getCategoryName(data.category)}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("아카이브 갤러리 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 갤러리 목록을 불러오는데 실패했습니다.</p>';
    }
}

function getCategoryName(category) {
    const categories = {
        'production': '제작 현장',
        'interview': '인터뷰',
        'daily': '일상',
        'document': '자료'
    };
    return categories[category] || category;
}

async function loadSystemLogs() {
    try {
        document.getElementById("total-errors").textContent = "23";
        document.getElementById("today-errors").textContent = "2";
        document.getElementById("active-sessions").textContent = "45";
        document.getElementById("uptime-hours").textContent = "127";
    } catch (error) {
        console.error("시스템 로그 로딩 실패:", error);
    }
}

async function loadErrorLogs() {
    const container = document.getElementById("error-logs");
    container.innerHTML = `
        <div class="content-item urgent-item">
            <h4>🚨 Firebase 연결 오류</h4>
            <p>1시간 전 - Firebase 연결이 일시적으로 중단되었습니다.</p>
        </div>
        <div class="content-item">
            <h4>⚠️ 이미지 업로드 실패</h4>
            <p>3시간 전 - 사용자 이미지 업로드 중 오류가 발생했습니다.</p>
        </div>
    `;
}

async function loadActivityLogs() {
    const container = document.getElementById("activity-logs");
    container.innerHTML = `
        <div class="content-item">
            <h4>📝 새 일기 작성</h4>
            <p>30분 전 - 관리자가 새 일기를 작성했습니다.</p>
        </div>
        <div class="content-item">
            <h4>🎥 영상 업로드</h4>
            <p>2시간 전 - 새 영상이 업로드되었습니다.</p>
        </div>
        <div class="content-item">
            <h4>💬 채팅 세션 시작</h4>
            <p>1시간 전 - 새 사용자가 채팅을 시작했습니다.</p>
        </div>
    `;
}

async function loadDatabaseStatus() {
    const container = document.getElementById("database-status");
    container.innerHTML = `
        <div class="content-item">
            <h4>✅ 연결 상태: 정상</h4>
            <p>Firebase Firestore 연결이 정상입니다.</p>
        </div>
        <div class="content-item">
            <h4>📊 저장소 사용량: 45%</h4>
            <p>현재 저장소 사용량이 양호합니다.</p>
        </div>
        <div class="content-item">
            <h4>⚡ 응답 시간: 120ms</h4>
            <p>데이터베이스 응답 시간이 정상 범위입니다.</p>
        </div>
    `;
}

async function loadPerformanceMetrics() {
    const container = document.getElementById("performance-metrics");
    container.innerHTML = `
        <div class="content-item">
            <h4>⚡ 평균 로딩 시간: 1.2초</h4>
            <p>페이지 로딩 속도가 양호합니다.</p>
        </div>
        <div class="content-item">
            <h4>📱 모바일 호환성: 98%</h4>
            <p>모바일 장치에서 정상 작동합니다.</p>
        </div>
        <div class="content-item">
            <h4>🔒 보안 점수: A+</h4>
            <p>보안 설정이 우수합니다.</p>
        </div>
    `;
}

async function clearOldLogs() {
    if (confirm("30일 이상된 로그를 모두 삭제하시겠습니까?")) {
        showMessage(document.getElementById("system-management-message"), "오래된 로그가 성공적으로 정리되었습니다.", "success");
    }
}

async function backupData() {
    showMessage(document.getElementById("system-management-message"), "데이터 백업이 시작되었습니다. 완료되면 알림을 드리겠습니다.", "success");
}

async function systemHealthCheck() {
    showMessage(document.getElementById("system-management-message"), "시스템 건강 체크가 완료되었습니다. 모든 시스템이 정상 작동 중입니다.", "success");
}

window.deleteDiary = async function(docId) {
    if (confirm("이 일기를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "diaryPosts", docId));
            showMessage(document.getElementById("diary-message"), "일기가 성공적으로 삭제되었습니다.", "success");
            loadDiaryList();
        } catch (error) {
            console.error("일기 삭제 실패:", error);
            showMessage(document.getElementById("diary-message"), "일기 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteTimeline = async function(docId) {
    if (confirm("이 타임라인 이벤트를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "personalTimeline", docId));
            showMessage(document.getElementById("timeline-message"), "타임라인 이벤트가 성공적으로 삭제되었습니다.", "success");
            loadTimelineList();
        } catch (error) {
            console.error("타임라인 삭제 실패:", error);
            showMessage(document.getElementById("timeline-message"), "타임라인 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteGallery = async function(docId) {
    if (confirm("이 갤러리 사진을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "galleryPosts", docId));
            showMessage(document.getElementById("gallery-message"), "갤러리 사진이 성공적으로 삭제되었습니다.", "success");
            loadGalleryList();
        } catch (error) {
            console.error("갤러리 삭제 실패:", error);
            showMessage(document.getElementById("gallery-message"), "갤러리 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteVideo = async function(docId) {
    if (confirm("이 영상을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "documentaryVideos", docId));
            showMessage(document.getElementById("video-message"), "영상이 성공적으로 삭제되었습니다.", "success");
            loadVideoList();
        } catch (error) {
            console.error("영상 삭제 실패:", error);
            showMessage(document.getElementById("video-message"), "영상 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveTimeline = async function(docId) {
    if (confirm("이 아카이브 타임라인을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveTimeline", docId));
            showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인이 성공적으로 삭제되었습니다.", "success");
            loadArchiveTimelineList();
        } catch (error) {
            console.error("아카이브 타임라인 삭제 실패:", error);
            showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveVideo = async function(docId) {
    if (confirm("이 아카이브 영상을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveVideos", docId));
            showMessage(document.getElementById("archive-video-message"), "아카이브 영상이 성공적으로 삭제되었습니다.", "success");
            loadArchiveVideosList();
        } catch (error) {
            console.error("아카이브 영상 삭제 실패:", error);
            showMessage(document.getElementById("archive-video-message"), "아카이브 영상 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveGallery = async function(docId) {
    if (confirm("이 아카이브 갤러리를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveGallery", docId));
            showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리가 성공적으로 삭제되었습니다.", "success");
            loadArchiveGalleryList();
        } catch (error) {
            console.error("아카이브 갤러리 삭제 실패:", error);
            showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.showChatDetail = showChatDetail;
</script>

</body>
</html><!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>감독 관리 패널</title>
<style>
body {
    background-color: #4e2e1e;
    color: #f5f0e6;
    font-family: "Song Myung", serif;
}

.admin-panel {
    max-width: 1400px;
    margin: 0 auto;
    padding: 100px 20px 20px;
    font-family: "Song Myung", serif;
    background-color: #4e2e1e;
}

.panel-header {
    text-align: center;
    margin-bottom: 3rem;
    background: rgba(245, 240, 230, 0.05);
    padding: 2rem;
    border-radius: 12px;
    border-left: 4px solid #8d6e63;
}

.panel-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    color: #f5f0e6;
}

.panel-header p {
    color: #d4c4a8;
    font-size: 1.2em;
    margin: 0;
}

.management-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
    background: rgba(245, 240, 230, 0.05);
    border-radius: 12px;
    padding: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.tab-button {
    padding: 12px 24px;
    background: rgba(245, 240, 230, 0.1);
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 25px;
    color: #f5f0e6;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1.1em;
    transition: all 0.3s ease;
}

.tab-button:hover {
    background: rgba(245, 240, 230, 0.15);
    transform: translateY(-2px);
}

.tab-button.active {
    background: #8d6e63;
    border-color: #8d6e63;
    color: #f5f0e6;
}

.management-card {
    background: rgba(245, 240, 230, 0.05);
    border: 1px solid rgba(245, 240, 230, 0.1);
    border-left: 4px solid #8d6e63;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
}

.management-card:hover {
    background: rgba(245, 240, 230, 0.08);
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.card-title {
    color: #f5f0e6;
    font-size: 1.8em;
    margin-bottom: 1rem;
    text-align: center;
    border-bottom: 2px solid rgba(245, 240, 230, 0.2);
    padding-bottom: 0.5rem;
}

.section-info {
    background: rgba(141, 110, 99, 0.2);
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #8d6e63;
}

.section-info h4 {
    color: #f5f0e6;
    margin: 0 0 8px 0;
    font-size: 1.2em;
}

.section-info p {
    color: #d4c4a8;
    margin: 0;
    line-height: 1.4;
    font-size: 0.95em;
}

.form-section {
    margin-bottom: 2rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    color: #d4c4a8;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 1.1em;
}

.form-section input,
.form-section textarea,
.form-section select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 8px;
    background: rgba(245, 240, 230, 0.1);
    color: #f5f0e6;
    font-family: "Song Myung", serif;
    font-size: 1em;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.form-section input:focus,
.form-section textarea:focus,
.form-section select:focus {
    outline: none;
    border-color: #8d6e63;
    background: rgba(245, 240, 230, 0.15);
    box-shadow: 0 0 15px rgba(141, 110, 99, 0.3);
}

.form-section textarea {
    resize: vertical;
    min-height: 100px;
    line-height: 1.6;
}

.form-section button,
.action-btn {
    padding: 12px 25px;
    background: #8d6e63;
    color: #f5f0e6;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1.1em;
    transition: all 0.3s ease;
    min-width: 140px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.form-section button:hover,
.action-btn:hover {
    background: #a1887f;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(141, 110, 99, 0.4);
}

.danger-btn {
    background: #dc3545 !important;
}

.danger-btn:hover {
    background: #c82333 !important;
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4) !important;
}

.secondary-btn {
    background: rgba(245, 240, 230, 0.1) !important;
    border: 1px solid rgba(245, 240, 230, 0.2) !important;
}

.secondary-btn:hover {
    background: rgba(245, 240, 230, 0.15) !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
}

.login-section {
    max-width: 500px;
    margin: 200px auto;
    text-align: center;
    background: rgba(245, 240, 230, 0.05);
    padding: 3rem;
    border-radius: 12px;
    border-left: 4px solid #8d6e63;
}

.login-section h1 {
    color: #f5f0e6;
    font-size: 2.2em;
    margin-bottom: 20px;
}

.login-section p {
    color: #d4c4a8;
    font-size: 1.1em;
    line-height: 1.6;
    margin-bottom: 2rem;
}

.login-section input {
    width: 100%;
    max-width: 300px;
    padding: 15px 20px;
    margin: 15px 0;
    border: 1px solid rgba(245, 240, 230, 0.3);
    border-radius: 25px;
    background: rgba(245, 240, 230, 0.1);
    color: #f5f0e6;
    font-size: 1.1em;
    text-align: center;
    transition: all 0.3s ease;
}

.login-section input:focus {
    outline: none;
    border-color: #8d6e63;
    background: rgba(245, 240, 230, 0.15);
    box-shadow: 0 0 15px rgba(141, 110, 99, 0.3);
}

.login-section button {
    padding: 15px 30px;
    font-size: 1.2em;
    margin-top: 10px;
}

.logout-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    background: #dc3545;
    color: #f5f0e6;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-family: "Song Myung", serif;
    font-size: 1em;
    z-index: 1000;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.logout-btn:hover {
    background: #c82333;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

.status-message {
    padding: 15px 20px;
    margin: 15px 0;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    border-left: 4px solid;
}

.success {
    background: rgba(92, 184, 92, 0.2);
    color: #5cb85c;
    border-color: #5cb85c;
}

.error {
    background: rgba(217, 83, 79, 0.2);
    color: #d9534f;
    border-color: #d9534f;
}

.management-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.stat-card {
    background: rgba(141, 110, 99, 0.2);
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid rgba(245, 240, 230, 0.1);
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #f5f0e6;
    display: block;
    margin-bottom: 8px;
}

.stat-label {
    color: #d4c4a8;
    font-size: 1em;
}

.content-list {
    max-height: 400px;
    overflow-y: auto;
    margin: 20px 0;
    border-top: 1px solid rgba(245, 240, 230, 0.2);
    padding-top: 20px;
}

.content-item {
    background: rgba(245, 240, 230, 0.05);
    border-left: 4px solid #8d6e63;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.content-item:hover {
    background: rgba(245, 240, 230, 0.1);
    transform: translateX(5px);
}

.content-item h4 {
    color: #f5f0e6;
    margin: 0 0 8px 0;
}

.content-item p {
    color: #d4c4a8;
    margin: 5px 0 0 0;
    font-size: 0.9em;
}

.urgent-item {
    border-left-color: #dc3545 !important;
    background: rgba(220, 53, 69, 0.1) !important;
}

.urgent-item h4 {
    color: #ff6b6b !important;
}

.file-info {
    margin-top: 8px;
    padding: 8px 12px;
    background: rgba(141, 110, 99, 0.2);
    border-radius: 6px;
    font-size: 0.9em;
    color: #d4c4a8;
}

.delete-btn {
    background: #dc3545 !important;
    color: #f5f0e6 !important;
    border: none !important;
    padding: 6px 12px !important;
    border-radius: 15px !important;
    font-size: 0.85em !important;
    margin-left: 10px !important;
    min-width: auto !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

.delete-btn:hover {
    background: #c82333 !important;
    transform: translateY(-1px) !important;
}

.content-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.content-item-actions {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
}

.content-preview {
    max-width: 100px;
    max-height: 60px;
    object-fit: cover;
    border-radius: 4px;
    margin-right: 10px;
    float: left;
}

.hidden {
    display: none !important;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
}

.chat-detail-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.chat-detail-content {
    background: #4e2e1e;
    border: 1px solid rgba(245, 240, 230, 0.2);
    border-radius: 12px;
    padding: 30px;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    color: #f5f0e6;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    color: #f5f0e6;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    color: #dc3545;
}

.chat-message {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #8d6e63;
}

.chat-message.user {
    background: rgba(141, 110, 99, 0.2);
    border-left-color: #8d6e63;
}

.chat-message.bot {
    background: rgba(245, 240, 230, 0.1);
    border-left-color: #d4c4a8;
}

.chat-message h5 {
    margin: 0 0 10px 0;
    color: #f5f0e6;
    font-size: 1.1em;
}

.chat-message p {
    margin: 0;
    line-height: 1.6;
    white-space: pre-wrap;
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

@media (max-width: 768px) {
    .admin-panel {
        padding: 120px 15px 20px;
    }
    
    .panel-header {
        padding: 1.5rem;
    }
    
    .panel-header h1 {
        font-size: 2em;
    }
    
    .management-tabs {
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }
    
    .tab-button {
        width: 100%;
        max-width: 300px;
        text-align: center;
    }
    
    .management-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .management-card {
        padding: 1.5rem;
    }
    
    .login-section {
        margin: 120px auto;
        padding: 2rem;
    }
    
    .login-section h1 {
        font-size: 1.8em;
    }

    .chat-detail-content {
        margin: 20px;
        max-width: calc(100vw - 40px);
        max-height: calc(100vh - 40px);
    }
}
</style>
</head>
<body class="song-myung-regular">

<div id="login-section" class="login-section">
<h1>🎬 감독 관리 패널</h1>
<p>
    이 페이지는 감독 전용입니다.<br>
    마스터키를 입력해 주세요.
</p>
<input type="password" id="master-key" placeholder="마스터키 입력" />
<br>
<button id="login-btn">로그인</button>
<div id="login-message" style="margin-top: 1rem;"></div>
</div>

<div id="admin-panel" class="admin-panel hidden">
<button class="logout-btn" id="logout-btn">로그아웃</button>

<div class="panel-header">
    <h1>🎬 감독 관리 패널</h1>
    <p>모든 콘텐츠를 한 곳에서 관리하세요</p>
</div>

<div class="management-tabs">
    <button class="tab-button active" onclick="showTab('diary')">📝 나의 일기</button>
    <button class="tab-button" onclick="showTab('timeline')">⏰ 나의 타임라인</button>
    <button class="tab-button" onclick="showTab('gallery')">📸 기록 갤러리</button>
    <button class="tab-button" onclick="showTab('video')">🎥 다큐 영상</button>
    <button class="tab-button" onclick="showTab('archive-timeline')">📅 아카이브 타임라인</button>
    <button class="tab-button" onclick="showTab('archive-videos')">🎬 아카이브 영상</button>
    <button class="tab-button" onclick="showTab('archive-gallery')">📸 아카이브 갤러리</button>
    <button class="tab-button" onclick="showTab('chatbot')">💬 챗봇 분석</button>
    <button class="tab-button" onclick="showTab('system')">⚙️ 시스템 로그</button>
</div>

<div id="diary-tab" class="tab-content active">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">📝 나의 일기 작성</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 작성한 일기는 <strong>"나의 정신병 일지" 페이지</strong>에 표시됩니다.</p>
            </div>
            <form id="diary-form" class="form-section">
                <div class="form-group">
                    <label for="diary-title">일기 제목</label>
                    <input type="text" id="diary-title" placeholder="일기 제목을 입력하세요" required />
                </div>
                <div class="form-group">
                    <label for="diary-content">일기 내용</label>
                    <textarea id="diary-content" rows="10" placeholder="오늘의 일기를 써보세요..." required></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="diary-private"> 비공개 글로 작성
                    </label>
                </div>
                <button type="submit">일기 등록</button>
            </form>
            <div id="diary-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 등록된 일기 목록</h2>
            <div id="diary-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">일기 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-diary-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="timeline-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">⏰ 개인 타임라인 이벤트 추가</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 추가한 이벤트는 <strong>"나의 정신병 일지" 페이지의 타임라인</strong>에 표시됩니다.</p>
            </div>
            <form id="timeline-form" class="form-section">
                <div class="form-group">
                    <label for="person-select">인물 선택</label>
                    <select id="person-select" required>
                        <option value="">선택하세요</option>
                        <option value="jueun">주은</option>
                        <option value="soonkyung">순경</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="timeline-date">날짜</label>
                    <input type="date" id="timeline-date" required />
                </div>
                <div class="form-group">
                    <label for="timeline-title">이벤트 제목</label>
                    <input type="text" id="timeline-title" placeholder="이벤트 제목" required />
                </div>
                <div class="form-group">
                    <label for="timeline-content">이벤트 내용</label>
                    <textarea id="timeline-content" rows="4" placeholder="타임라인에 추가할 이벤트 내용을 입력하세요" required></textarea>
                </div>
                <button type="submit">이벤트 추가</button>
            </form>
            <div id="timeline-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 타임라인 이벤트 목록</h2>
            <div id="timeline-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-timeline-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="gallery-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">📸 기록 갤러리 사진 업로드</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 업로드한 사진은 <strong>"기록 갤러리" 페이지</strong>에 표시됩니다.</p>
            </div>
            <form id="gallery-form" class="form-section">
                <div class="form-group">
                    <label for="gallery-image">사진 선택</label>
                    <input type="file" id="gallery-image" accept="image/*" required />
                    <div id="gallery-file-info" class="file-info"></div>
                </div>
                <div class="form-group">
                    <label for="gallery-caption">사진 설명</label>
                    <textarea id="gallery-caption" rows="3" placeholder="사진에 대한 설명을 입력하세요" required></textarea>
                </div>
                <button type="submit">사진 업로드</button>
            </form>
            <div id="gallery-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 갤러리 사진 목록</h2>
            <div id="gallery-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-gallery-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="video-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">🎥 다큐 영상 업로드</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 업로드한 영상은 <strong>"영화 페이지의 다큐 영상" 섹션</strong>에 표시됩니다.</p>
            </div>
            <form id="video-form" class="form-section">
                <div class="form-group">
                    <label for="video-title">영상 제목</label>
                    <input type="text" id="video-title" placeholder="영상 제목을 입력하세요" required />
                </div>
                <div class="form-group">
                    <label for="video-description">영상 설명</label>
                    <textarea id="video-description" rows="3" placeholder="영상에 대한 설명을 입력하세요"></textarea>
                </div>
                
                <div class="form-group">
                    <label>영상 업로드 방식</label>
                    <div style="margin: 10px 0;">
                        <label style="margin-right: 20px;">
                            <input type="radio" name="video-type" value="youtube" checked> YouTube 링크
                        </label>
                        <label>
                            <input type="radio" name="video-type" value="file"> 파일 업로드
                        </label>
                    </div>
                </div>
                
                <div id="youtube-input" class="form-group">
                    <label for="youtube-url">YouTube URL</label>
                    <input type="url" id="youtube-url" placeholder="https://www.youtube.com/watch?v=..." />
                </div>
                
                <div id="file-input" class="form-group" style="display:none;">
                    <label for="video-file">비디오 파일</label>
                    <input type="file" id="video-file" accept=".mp4,.webm,.mov,.avi,.mkv,.flv,video/*" />
                    <div id="video-file-info" class="file-info"></div>
                </div>
                
                <button type="submit">영상 업로드</button>
            </form>
            <div id="video-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 업로드된 영상 목록</h2>
            <div id="video-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-video-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="archive-timeline-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">📅 아카이브 타임라인</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 추가한 이벤트는 <strong>"아카이빙" 페이지의 타임라인</strong>에 표시됩니다.</p>
            </div>
            <form id="archive-timeline-form" class="form-section">
                <div class="form-group">
                    <label for="archive-event-date">날짜</label>
                    <input type="date" id="archive-event-date" required />
                </div>
                <div class="form-group">
                    <label for="archive-event-title">이벤트 제목</label>
                    <input type="text" id="archive-event-title" placeholder="프로젝트 시작" required />
                </div>
                <div class="form-group">
                    <label for="archive-event-description">이벤트 설명</label>
                    <textarea id="archive-event-description" rows="4" placeholder="이벤트에 대한 상세 설명을 입력하세요" required></textarea>
                </div>
                <button type="submit">타임라인 이벤트 추가</button>
            </form>
            <div id="archive-timeline-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 아카이브 타임라인 목록</h2>
            <div id="archive-timeline-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-archive-timeline-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="archive-videos-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">🎬 아카이브 영상</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 추가한 영상은 <strong>"아카이빙" 페이지의 영상 섹션</strong>에 표시됩니다.</p>
            </div>
            <form id="archive-video-form" class="form-section">
                <div class="form-group">
                    <label for="archive-video-title">영상 제목</label>
                    <input type="text" id="archive-video-title" placeholder="프로젝트 티저 영상" required />
                </div>
                <div class="form-group">
                    <label for="archive-video-description">영상 설명</label>
                    <textarea id="archive-video-description" rows="3" placeholder="영상에 대한 설명을 입력하세요" required></textarea>
                </div>
                <div class="form-group">
                    <label for="archive-video-url">YouTube URL</label>
                    <input type="url" id="archive-video-url" placeholder="https://www.youtube.com/watch?v=..." required />
                </div>
                <div class="form-group">
                    <label for="archive-video-duration">영상 길이</label>
                    <input type="text" id="archive-video-duration" placeholder="2:30" required />
                </div>
                <button type="submit">영상 추가</button>
            </form>
            <div id="archive-video-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 아카이브 영상 목록</h2>
            <div id="archive-videos-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-archive-videos-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="archive-gallery-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">📸 아카이브 갤러리</h2>
            <div class="section-info">
                <h4>📍 업로드 위치</h4>
                <p>여기서 업로드한 사진은 <strong>"아카이빙" 페이지의 갤러리 섹션</strong>에 표시됩니다.</p>
            </div>
            <form id="archive-gallery-form" class="form-section">
                <div class="form-group">
                    <label for="archive-gallery-image">사진 선택</label>
                    <input type="file" id="archive-gallery-image" accept="image/*" required />
                    <div id="archive-gallery-file-info" class="file-info"></div>
                </div>
                <div class="form-group">
                    <label for="archive-gallery-title">사진 제목</label>
                    <input type="text" id="archive-gallery-title" placeholder="첫 번째 촬영 현장" required />
                </div>
                <div class="form-group">
                    <label for="archive-gallery-description">사진 설명</label>
                    <textarea id="archive-gallery-description" rows="3" placeholder="사진에 대한 설명을 입력하세요" required></textarea>
                </div>
                <div class="form-group">
                    <label for="archive-gallery-category">카테고리</label>
                    <select id="archive-gallery-category" required>
                        <option value="">카테고리 선택</option>
                        <option value="production">제작 현장</option>
                        <option value="interview">인터뷰</option>
                        <option value="daily">일상</option>
                        <option value="document">자료</option>
                    </select>
                </div>
                <button type="submit">갤러리에 추가</button>
            </form>
            <div id="archive-gallery-message"></div>
        </div>

        <div class="management-card">
            <h2 class="card-title">📋 아카이브 갤러리 목록</h2>
            <div id="archive-gallery-list" class="content-list">
                <p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-archive-gallery-btn" class="action-btn secondary-btn" style="width: 100%;">
                목록 새로고침
            </button>
        </div>
    </div>
</div>

<div id="chatbot-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">📊 대화 통계</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-chats">-</span>
                    <span class="stat-label">총 대화 수</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="active-users">-</span>
                    <span class="stat-label">활성 사용자</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="today-chats">-</span>
                    <span class="stat-label">오늘 대화</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avg-messages">-</span>
                    <span class="stat-label">평균 메시지 수</span>
                </div>
            </div>
            <button type="button" id="refresh-stats-btn" class="action-btn secondary-btn" style="width: 100%;">
                통계 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">😢 감정 분석</h2>
            <div id="emotion-analysis" class="content-list">
                <p style="text-align: center; color: #8d6e63;">감정 데이터를 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-emotions-btn" class="action-btn secondary-btn" style="width: 100%;">
                감정 분석 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">🚨 긴급 상황</h2>
            <div id="urgent-messages" class="content-list">
                <p style="text-align: center; color: #8d6e63;">긴급 메시지를 확인하는 중...</p>
            </div>
            <button type="button" id="refresh-urgent-btn" class="action-btn danger-btn" style="width: 100%;">
                긴급 상황 새로고침
            </button>
        </div>
    </div>

    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">💬 전체 대화 목록</h2>
            <div id="all-chats" class="content-list">
                <p style="text-align: center; color: #8d6e63;">전체 대화를 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-all-chats-btn" class="action-btn secondary-btn" style="width: 100%;">
                전체 대화 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">📈 주제별 분석</h2>
            <div id="topic-analysis" class="content-list">
                <p style="text-align: center; color: #8d6e63;">주제 분석 중...</p>
            </div>
            <button type="button" id="refresh-topics-btn" class="action-btn secondary-btn" style="width: 100%;">
                주제 분석 새로고침
            </button>
        </div>
    </div>
</div>

<div id="system-tab" class="tab-content">
    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">⚙️ 시스템 로그</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-errors">-</span>
                    <span class="stat-label">총 오류 수</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="today-errors">-</span>
                    <span class="stat-label">오늘 오류</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="active-sessions">-</span>
                    <span class="stat-label">활성 세션</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="uptime-hours">-</span>
                    <span class="stat-label">가동 시간(시간)</span>
                </div>
            </div>
            <button type="button" id="refresh-system-btn" class="action-btn secondary-btn" style="width: 100%;">
                시스템 상태 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">🚨 오류 로그</h2>
            <div id="error-logs" class="content-list">
                <p style="text-align: center; color: #8d6e63;">오류 로그를 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-errors-btn" class="action-btn secondary-btn" style="width: 100%;">
                오류 로그 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">📊 활동 로그</h2>
            <div id="activity-logs" class="content-list">
                <p style="text-align: center; color: #8d6e63;">활동 로그를 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-activity-btn" class="action-btn secondary-btn" style="width: 100%;">
                활동 로그 새로고침
            </button>
        </div>
    </div>

    <div class="management-grid">
        <div class="management-card">
            <h2 class="card-title">💾 데이터베이스 상태</h2>
            <div id="database-status" class="content-list">
                <p style="text-align: center; color: #8d6e63;">데이터베이스 상태를 확인하는 중...</p>
            </div>
            <button type="button" id="refresh-db-btn" class="action-btn secondary-btn" style="width: 100%;">
                DB 상태 확인
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">📈 성능 지표</h2>
            <div id="performance-metrics" class="content-list">
                <p style="text-align: center; color: #8d6e63;">성능 지표를 불러오는 중...</p>
            </div>
            <button type="button" id="refresh-performance-btn" class="action-btn secondary-btn" style="width: 100%;">
                성능 지표 새로고침
            </button>
        </div>

        <div class="management-card">
            <h2 class="card-title">🔧 시스템 관리</h2>
            <div class="form-section">
                <button type="button" id="clear-old-logs-btn" class="action-btn danger-btn" style="width: 100%; margin-bottom: 10px;">
                    오래된 로그 정리 (30일 이상)
                </button>
                <button type="button" id="backup-data-btn" class="action-btn secondary-btn" style="width: 100%; margin-bottom: 10px;">
                    데이터 백업 생성
                </button>
                <button type="button" id="system-health-check-btn" class="action-btn" style="width: 100%;">
                    시스템 건강 체크
                </button>
            </div>
            <div id="system-management-message"></div>
        </div>
    </div>
</div>

</div>

<div id="chat-detail-modal" class="chat-detail-modal">
    <div class="chat-detail-content">
        <button class="modal-close">&times;</button>
        <h3 id="chat-detail-title">대화 내용</h3>
        <div id="chat-detail-body"></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query, orderBy, deleteDoc, doc, where, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL, uploadBytesResumable, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIU8q64ZB6g8D72SPcCxxkOQmhtREN9cg",
  authDomain: "we-are-psychopath.firebaseapp.com",
  projectId: "we-are-psychopath",
  storageBucket: "we-are-psychopath.firebasestorage.app",
  messagingSenderId: "1020831167882",
  appId: "1:1020831167882:web:addcfd266307c3bb71c473",
  measurementId: "G-MG2X69DDK8"
};

const MASTER_KEY = "189512";

const loginSection = document.getElementById("login-section");
const adminPanel = document.getElementById("admin-panel");
const masterKeyInput = document.getElementById("master-key");
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const loginMessage = document.getElementById("login-message");

let app, db, storage;

function showMessage(element, message, type = "success") {
    if (!element) return;
    element.innerHTML = `<div class="status-message ${type}">${message}</div>`;
    setTimeout(() => {
        if (element.innerHTML.includes(message)) {
            element.innerHTML = "";
        }
    }, 5000);
}

function clearAllForms() {
    const forms = document.querySelectorAll("form");
    forms.forEach(form => form.reset());
    
    const fileInfoElements = document.querySelectorAll(".file-info");
    fileInfoElements.forEach(el => el.innerHTML = "");
    
    const messageElements = document.querySelectorAll("[id$='-message']");
    messageElements.forEach(el => el.innerHTML = "");
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function displayFileInfo(inputElement, infoElement) {
    if (!inputElement || !infoElement) return;
    
    inputElement.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const fileSize = formatFileSize(file.size);
            const fileType = file.type || '알 수 없음';
            infoElement.innerHTML = `
                <strong>선택된 파일:</strong> ${file.name}<br>
                <strong>크기:</strong> ${fileSize}<br>
                <strong>형식:</strong> ${fileType}
            `;
        } else {
            infoElement.innerHTML = "";
        }
    });
}

function convertToEmbedUrl(url) {
    if (!url) return '';
    
    const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
    if (youtubeMatch) {
        return `https://www.youtube.com/embed/${youtubeMatch[1]}`;
    }
    
    const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
    if (vimeoMatch) {
        return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
    }
    
    return url;
}

async function initializeFirebase() {
  try {
    if (!app) {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      storage = getStorage(app);
      
      window.db = db;
      window.storage = storage;
      
      return true;
    }
    return true;
  } catch (error) {
    console.error("Firebase 초기화 실패:", error);
    return false;
  }
}

document.addEventListener("DOMContentLoaded", async () => {
    await initializeFirebase();
});

async function handleLogin() {
    const inputKey = masterKeyInput.value.trim();
    
    if (inputKey === MASTER_KEY) {
        showMessage(loginMessage, "로그인 성공!", "success");
        
        const firebaseReady = await initializeFirebase();
        
        setTimeout(() => {
            loginSection.classList.add("hidden");
            adminPanel.classList.remove("hidden");
            
            if (firebaseReady) {
                initializeForms();
                loadChatbotStats();
                loadDiaryList();
                loadTimelineList();
                loadGalleryList();
                loadVideoList();
                loadArchiveTimelineList();
                loadArchiveVideosList();
                loadArchiveGalleryList();
            }
        }, 500);
    } else {
        showMessage(loginMessage, "마스터키가 올바르지 않습니다.", "error");
    }
}

loginBtn.addEventListener("click", handleLogin);

masterKeyInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
        handleLogin();
    }
});

logoutBtn.addEventListener("click", () => {
    if (confirm("로그아웃 하시겠습니까?")) {
        adminPanel.classList.add("hidden");
        loginSection.classList.remove("hidden");
        masterKeyInput.value = "";
        clearAllForms();
    }
});

window.showTab = function(tabName) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');
    
    if (tabName === 'chatbot') {
        loadChatbotStats();
    } else if (tabName === 'diary') {
        loadDiaryList();
    } else if (tabName === 'timeline') {
        loadTimelineList();
    } else if (tabName === 'gallery') {
        loadGalleryList();
    } else if (tabName === 'video') {
        loadVideoList();
    } else if (tabName === 'archive-timeline') {
        loadArchiveTimelineList();
    } else if (tabName === 'archive-videos') {
        loadArchiveVideosList();
    } else if (tabName === 'archive-gallery') {
        loadArchiveGalleryList();
    } else if (tabName === 'system') {
        loadSystemLogs();
    }
};

function initializeForms() {
    const diaryForm = document.getElementById("diary-form");
    if (diaryForm) {
        diaryForm.addEventListener("submit", handleDiarySubmit);
    }
    
    const timelineForm = document.getElementById("timeline-form");
    if (timelineForm) {
        timelineForm.addEventListener("submit", handleTimelineSubmit);
    }
    
    const galleryForm = document.getElementById("gallery-form");
    if (galleryForm) {
        galleryForm.addEventListener("submit", handleGallerySubmit);
        displayFileInfo(
            document.getElementById("gallery-image"),
            document.getElementById("gallery-file-info")
        );
    }
    
    const videoForm = document.getElementById("video-form");
    if (videoForm) {
        videoForm.addEventListener("submit", handleVideoSubmit);
        setupVideoForm();
        displayFileInfo(
            document.getElementById("video-file"),
            document.getElementById("video-file-info")
        );
    }
    
    initializeArchiveForms();
    initializeChatbotButtons();
    setupChatDetailModal();
}

function setupVideoForm() {
    const videoTypeRadios = document.querySelectorAll('input[name="video-type"]');
    const youtubeInput = document.getElementById("youtube-input");
    const fileInput = document.getElementById("file-input");
    
    videoTypeRadios.forEach(radio => {
        radio.addEventListener("change", () => {
            if (radio.value === "youtube") {
                youtubeInput.style.display = "block";
                fileInput.style.display = "none";
            } else {
                youtubeInput.style.display = "none";
                fileInput.style.display = "block";
            }
        });
    });
}

function setupChatDetailModal() {
    const modal = document.getElementById('chat-detail-modal');
    const closeBtn = modal.querySelector('.modal-close');
    
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.style.display === 'block') {
            modal.style.display = 'none';
        }
    });
}

function showChatDetail(userMessage, botMessage, timestampSeconds) {
    const modal = document.getElementById('chat-detail-modal');
    const title = document.getElementById('chat-detail-title');
    const body = document.getElementById('chat-detail-body');
    
    const timeString = timestampSeconds ? new Date(timestampSeconds * 1000).toLocaleString('ko-KR') : '시간 미상';
    
    title.textContent = `대화 내용 - ${timeString}`;
    
    body.innerHTML = `
        <div class="chat-message user">
            <h5>👤 사용자</h5>
            <p>${userMessage.replace(/\\n/g, '\n')}</p>
        </div>
        <div class="chat-message bot">
            <h5>🤖 상담사</h5>
            <p>${botMessage.replace(/\\n/g, '\n')}</p>
        </div>
    `;
    
    modal.style.display = 'flex';
}

async function handleDiarySubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("diary-title").value.trim();
    const content = document.getElementById("diary-content").value.trim();
    const isPrivate = document.getElementById("diary-private").checked;
    
    if (!title || !content) {
        showMessage(document.getElementById("diary-message"), "제목과 내용을 모두 입력해주세요.", "error");
        return;
    }
    
    if (!window.db) {
        showMessage(document.getElementById("diary-message"), "Firebase가 초기화되지 않았습니다.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "diaryPosts"), {
            title,
            content,
            author: "주은",
            isPublic: !isPrivate,
            timestamp: serverTimestamp(),
            secretPassword: isPrivate ? "189512" : ""
        });
        
        showMessage(document.getElementById("diary-message"), "일기가 성공적으로 등록되었습니다!", "success");
        document.getElementById("diary-form").reset();
        loadDiaryList();
    } catch (error) {
        console.error("일기 등록 오류:", error);
        showMessage(document.getElementById("diary-message"), "일기 등록 중 오류가 발생했습니다.", "error");
    }
}

async function handleTimelineSubmit(e) {
    e.preventDefault();
    
    const person = document.getElementById("person-select").value;
    const date = document.getElementById("timeline-date").value;
    const title = document.getElementById("timeline-title").value.trim();
    const content = document.getElementById("timeline-content").value.trim();
    
    if (!person || !date || !title || !content) {
        showMessage(document.getElementById("timeline-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "personalTimeline"), {
            person,
            date,
            title,
            content,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("timeline-message"), "타임라인 이벤트가 성공적으로 추가되었습니다!", "success");
        document.getElementById("timeline-form").reset();
        loadTimelineList();
    } catch (error) {
        console.error("타임라인 이벤트 추가 오류:", error);
        showMessage(document.getElementById("timeline-message"), "이벤트 추가 중 오류가 발생했습니다.", "error");
    }
}

async function handleGallerySubmit(e) {
    e.preventDefault();
    
    const imageFile = document.getElementById("gallery-image").files[0];
    const caption = document.getElementById("gallery-caption").value.trim();
    
    if (!imageFile || !caption) {
        showMessage(document.getElementById("gallery-message"), "이미지와 설명을 모두 입력해주세요.", "error");
        return;
    }
    
    try {
        const storageRef = ref(window.storage, `gallery/${imageFile.name}_${Date.now()}`);
        await uploadBytes(storageRef, imageFile);
        const imageUrl = await getDownloadURL(storageRef);
        
        await addDoc(collection(window.db, "galleryPosts"), {
            imageUrl,
            caption,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("gallery-message"), "사진이 성공적으로 업로드되었습니다!", "success");
        document.getElementById("gallery-form").reset();
        document.getElementById("gallery-file-info").innerHTML = "";
        loadGalleryList();
    } catch (error) {
        console.error("사진 업로드 오류:", error);
        showMessage(document.getElementById("gallery-message"), "사진 업로드 중 오류가 발생했습니다.", "error");
    }
}

async function handleVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("video-title").value.trim();
    const description = document.getElementById("video-description").value.trim();
    const videoType = document.querySelector('input[name="video-type"]:checked').value;
    
    if (!title) {
        showMessage(document.getElementById("video-message"), "영상 제목을 입력해주세요.", "error");
        return;
    }
    
    try {
        let videoUrl = "";
        let isYoutube = false;
        
        if (videoType === "youtube") {
            const youtubeUrl = document.getElementById("youtube-url").value.trim();
            if (!youtubeUrl) {
                showMessage(document.getElementById("video-message"), "YouTube 링크를 입력해주세요.", "error");
                return;
            }
            videoUrl = convertToEmbedUrl(youtubeUrl);
            isYoutube = true;
        } else {
            const videoFile = document.getElementById("video-file").files[0];
            if (!videoFile) {
                showMessage(document.getElementById("video-message"), "비디오 파일을 선택해주세요.", "error");
                return;
            }
            
            const storageRef = ref(window.storage, `videos/${videoFile.name}_${Date.now()}`);
            await uploadBytes(storageRef, videoFile);
            videoUrl = await getDownloadURL(storageRef);
            isYoutube = false;
        }
        
        await addDoc(collection(window.db, "documentaryVideos"), {
            title,
            description,
            videoUrl,
            isYoutube,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("video-message"), "영상이 성공적으로 업로드되었습니다!", "success");
        document.getElementById("video-form").reset();
        document.getElementById("video-file-info").innerHTML = "";
        loadVideoList();
    } catch (error) {
        console.error("❌ 영상 업로드 오류:", error);
        showMessage(document.getElementById("video-message"), "영상 업로드 중 오류가 발생했습니다.", "error");
    }
}

// 아카이브 폼 초기화 함수들
function initializeArchiveForms() {
    console.log("📝 아카이브 폼 초기화 시작");
    
    // 아카이브 타임라인 폼
    const archiveTimelineForm = document.getElementById("archive-timeline-form");
    if (archiveTimelineForm) {
        archiveTimelineForm.addEventListener("submit", handleArchiveTimelineSubmit);
    }
    
    // 아카이브 비디오 폼
    const archiveVideoForm = document.getElementById("archive-video-form");
    if (archiveVideoForm) {
        archiveVideoForm.addEventListener("submit", handleArchiveVideoSubmit);
    }
    
    // 아카이브 갤러리 폼
    const archiveGalleryForm = document.getElementById("archive-gallery-form");
    if (archiveGalleryForm) {
        archiveGalleryForm.addEventListener("submit", handleArchiveGallerySubmit);
        displayFileInfo(
            document.getElementById("archive-gallery-image"),
            document.getElementById("archive-gallery-file-info")
        );
    }
    
    console.log("✅ 아카이브 폼 초기화 완료");
}

// 아카이브 타임라인 제출 핸들러
async function handleArchiveTimelineSubmit(e) {
    e.preventDefault();
    
    const date = document.getElementById("archive-event-date").value;
    const title = document.getElementById("archive-event-title").value.trim();
    const description = document.getElementById("archive-event-description").value.trim();
    
    if (!date || !title || !description) {
        showMessage(document.getElementById("archive-timeline-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        await addDoc(collection(window.db, "archiveTimeline"), {
            date,
            title,
            description,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인 이벤트가 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-timeline-form").reset();
        loadArchiveTimelineList();
    } catch (error) {
        console.error("❌ 아카이브 타임라인 추가 오류:", error);
        showMessage(document.getElementById("archive-timeline-message"), "타임라인 이벤트 추가 중 오류가 발생했습니다.", "error");
    }
}

// 아카이브 비디오 제출 핸들러
async function handleArchiveVideoSubmit(e) {
    e.preventDefault();
    
    const title = document.getElementById("archive-video-title").value.trim();
    const description = document.getElementById("archive-video-description").value.trim();
    const url = document.getElementById("archive-video-url").value.trim();
    const duration = document.getElementById("archive-video-duration").value.trim();
    
    if (!title || !description || !url || !duration) {
        showMessage(document.getElementById("archive-video-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        const embedUrl = convertToEmbedUrl(url);
        
        await addDoc(collection(window.db, "archiveVideos"), {
            title,
            description,
            url: embedUrl,
            duration,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-video-message"), "아카이브 영상이 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-video-form").reset();
        loadArchiveVideosList();
    } catch (error) {
        console.error("❌ 아카이브 영상 추가 오류:", error);
        showMessage(document.getElementById("archive-video-message"), "영상 추가 중 오류가 발생했습니다.", "error");
    }
}

// 아카이브 갤러리 제출 핸들러
async function handleArchiveGallerySubmit(e) {
    e.preventDefault();
    
    const imageFile = document.getElementById("archive-gallery-image").files[0];
    const title = document.getElementById("archive-gallery-title").value.trim();
    const description = document.getElementById("archive-gallery-description").value.trim();
    const category = document.getElementById("archive-gallery-category").value;
    
    if (!imageFile || !title || !description || !category) {
        showMessage(document.getElementById("archive-gallery-message"), "모든 필드를 입력해주세요.", "error");
        return;
    }
    
    try {
        const storageRef = ref(window.storage, `archive-gallery/${imageFile.name}_${Date.now()}`);
        await uploadBytes(storageRef, imageFile);
        const imageUrl = await getDownloadURL(storageRef);
        
        await addDoc(collection(window.db, "archiveGallery"), {
            imageUrl,
            title,
            description,
            category,
            timestamp: serverTimestamp()
        });
        
        showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리에 성공적으로 추가되었습니다!", "success");
        document.getElementById("archive-gallery-form").reset();
        document.getElementById("archive-gallery-file-info").innerHTML = "";
        loadArchiveGalleryList();
    } catch (error) {
        console.error("❌ 아카이브 갤러리 추가 오류:", error);
        showMessage(document.getElementById("archive-gallery-message"), "갤러리 추가 중 오류가 발생했습니다.", "error");
    }
}

// 챗봇 버튼 초기화
function initializeChatbotButtons() {
    // 새로고침 버튼들
    document.getElementById("refresh-stats-btn")?.addEventListener("click", loadChatbotStats);
    document.getElementById("refresh-emotions-btn")?.addEventListener("click", loadEmotionAnalysis);
    document.getElementById("refresh-urgent-btn")?.addEventListener("click", loadUrgentMessages);
    document.getElementById("refresh-all-chats-btn")?.addEventListener("click", loadAllChats);
    document.getElementById("refresh-topics-btn")?.addEventListener("click", loadTopicAnalysis);
    
    // 다이어리 새로고침
    document.getElementById("refresh-diary-btn")?.addEventListener("click", loadDiaryList);
    
    // 타임라인 새로고침
    document.getElementById("refresh-timeline-btn")?.addEventListener("click", loadTimelineList);
    
    // 갤러리 새로고침
    document.getElementById("refresh-gallery-btn")?.addEventListener("click", loadGalleryList);
    
    // 비디오 새로고침
    document.getElementById("refresh-video-btn")?.addEventListener("click", loadVideoList);
    
    // 아카이브 새로고침
    document.getElementById("refresh-archive-timeline-btn")?.addEventListener("click", loadArchiveTimelineList);
    document.getElementById("refresh-archive-videos-btn")?.addEventListener("click", loadArchiveVideosList);
    document.getElementById("refresh-archive-gallery-btn")?.addEventListener("click", loadArchiveGalleryList);
    
    // 시스템 관련 버튼들
    document.getElementById("refresh-system-btn")?.addEventListener("click", loadSystemLogs);
    document.getElementById("refresh-errors-btn")?.addEventListener("click", loadErrorLogs);
    document.getElementById("refresh-activity-btn")?.addEventListener("click", loadActivityLogs);
    document.getElementById("refresh-db-btn")?.addEventListener("click", loadDatabaseStatus);
    document.getElementById("refresh-performance-btn")?.addEventListener("click", loadPerformanceMetrics);
    
    // 시스템 관리 버튼들
    document.getElementById("clear-old-logs-btn")?.addEventListener("click", clearOldLogs);
    document.getElementById("backup-data-btn")?.addEventListener("click", backupData);
    document.getElementById("system-health-check-btn")?.addEventListener("click", systemHealthCheck);
}

// 로딩 함수들 (스텁 구현)
async function loadChatbotStats() {
    console.log("📊 챗봇 통계 로딩");
    try {
        // 실제 구현에서는 Firebase에서 채팅 데이터를 가져와야 함
        document.getElementById("total-chats").textContent = "127";
        document.getElementById("active-users").textContent = "34";
        document.getElementById("today-chats").textContent = "12";
        document.getElementById("avg-messages").textContent = "8.5";
    } catch (error) {
        console.error("❌ 챗봇 통계 로딩 실패:", error);
    }
}

async function loadEmotionAnalysis() {
    console.log("😢 감정 분석 로딩");
    const container = document.getElementById("emotion-analysis");
    container.innerHTML = `
        <div class="content-item">
            <h4>😢 우울 - 32%</h4>
            <p>가장 많이 감지된 감정</p>
        </div>
        <div class="content-item">
            <h4>😰 불안 - 28%</h4>
            <p>두 번째로 많은 감정</p>
        </div>
        <div class="content-item">
            <h4>😊 긍정 - 25%</h4>
            <p>긍정적인 감정 표현</p>
        </div>
        <div class="content-item">
            <h4>😡 분노 - 15%</h4>
            <p>가장 적게 감지된 감정</p>
        </div>
    `;
}

async function loadUrgentMessages() {
    console.log("🚨 긴급 메시지 로딩");
    const container = document.getElementById("urgent-messages");
    container.innerHTML = `
        <div class="content-item urgent-item">
            <h4>⚠️ 자해 언급 감지</h4>
            <p>2시간 전 - 사용자가 자해에 대한 언급을 했습니다.</p>
        </div>
        <div class="content-item urgent-item">
            <h4>🆘 극도의 우울감 표현</h4>
            <p>6시간 전 - 매우 높은 수준의 우울감이 감지되었습니다.</p>
        </div>
    `;
}

async function loadAllChats() {
    console.log("💬 전체 대화 로딩");
    const container = document.getElementById("all-chats");
    container.innerHTML = `
        <div class="content-item" onclick="showChatDetail('오늘 정말 힘든 하루였어요...', '많이 힘드셨군요. 어떤 일이 있었는지 이야기해주실 수 있나요?', 1672531200)">
            <h4>💬 대화 #127</h4>
            <p>2시간 전 - 클릭하여 전체 대화 보기</p>
        </div>
        <div class="content-item" onclick="showChatDetail('계속 불안해요...', '불안감을 느끼고 계시는군요. 구체적으로 어떤 상황에서 불안을 느끼시나요?', 1672527600)">
            <h4>💬 대화 #126</h4>
            <p>4시간 전 - 클릭하여 전체 대화 보기</p>
        </div>
    `;
}

async function loadTopicAnalysis() {
    console.log("📈 주제 분석 로딩");
    const container = document.getElementById("topic-analysis");
    container.innerHTML = `
        <div class="content-item">
            <h4>📚 학업 스트레스 - 35%</h4>
            <p>가장 많이 언급된 주제</p>
        </div>
        <div class="content-item">
            <h4>👨‍👩‍👧‍👦 가족 관계 - 28%</h4>
            <p>두 번째로 많은 주제</p>
        </div>
        <div class="content-item">
            <h4>💼 취업 고민 - 22%</h4>
            <p>세 번째로 많은 주제</p>
        </div>
        <div class="content-item">
            <h4>❤️ 연애 관계 - 15%</h4>
            <p>상대적으로 적은 주제</p>
        </div>
    `;
}

async function loadDiaryList() {
    console.log("📝 일기 목록 로딩");
    const container = document.getElementById("diary-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">일기 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "diaryPosts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 일기가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteDiary('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.content ? data.content.substring(0, 100) + (data.content.length > 100 ? '...' : '') : '내용 없음'}</p>
                    <p><strong>작성자:</strong> ${data.author || '알 수 없음'} | <strong>날짜:</strong> ${date} | <strong>공개:</strong> ${data.isPublic ? '공개' : '비공개'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 일기 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">일기 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadTimelineList() {
    console.log("⏰ 타임라인 목록 로딩");
    const container = document.getElementById("timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "personalTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 타임라인 이벤트가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteTimeline('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.content || '내용 없음'}</p>
                    <p><strong>인물:</strong> ${data.person === 'jueun' ? '주은' : '순경'} | <strong>날짜:</strong> ${data.date || '날짜 미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 타임라인 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">타임라인 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadGalleryList() {
    console.log("📸 갤러리 목록 로딩");
    const container = document.getElementById("gallery-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "galleryPosts"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 사진이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>📸 갤러리 사진</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteGallery('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="content-preview" alt="갤러리 이미지">` : ''}
                    <p>${data.caption || '설명 없음'}</p>
                    <p><strong>업로드 날짜:</strong> ${date}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 갤러리 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">갤러리 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadVideoList() {
    console.log("🎥 비디오 목록 로딩");
    const container = document.getElementById("video-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "documentaryVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 영상이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const date = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleDateString('ko-KR') : '날짜 미상';
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteVideo('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>유형:</strong> ${data.isYoutube ? 'YouTube' : '파일 업로드'} | <strong>업로드 날짜:</strong> ${date}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 영상 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">영상 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveTimelineList() {
    console.log("📅 아카이브 타임라인 목록 로딩");
    const container = document.getElementById("archive-timeline-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">타임라인 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveTimeline"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 타임라인이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveTimeline('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>날짜:</strong> ${data.date || '날짜 미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 아카이브 타임라인 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 타임라인 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveVideosList() {
    console.log("🎬 아카이브 영상 목록 로딩");
    const container = document.getElementById("archive-videos-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">영상 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveVideos"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 영상이 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveVideo('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>길이:</strong> ${data.duration || '미상'}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 아카이브 영상 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 영상 목록을 불러오는데 실패했습니다.</p>';
    }
}

async function loadArchiveGalleryList() {
    console.log("📸 아카이브 갤러리 목록 로딩");
    const container = document.getElementById("archive-gallery-list");
    container.innerHTML = '<p style="text-align: center; color: #8d6e63;">갤러리 목록을 불러오는 중...</p>';
    
    try {
        if (!window.db) {
            container.innerHTML = '<p style="text-align: center; color: #dc3545;">Firebase가 초기화되지 않았습니다.</p>';
            return;
        }
        
        const q = query(collection(window.db, "archiveGallery"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
            container.innerHTML = '<p style="text-align: center; color: #8d6e63;">등록된 아카이브 갤러리가 없습니다.</p>';
            return;
        }
        
        let html = '';
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            
            html += `
                <div class="content-item">
                    <div class="content-item-header">
                        <h4>${data.title || '제목 없음'}</h4>
                        <div class="content-item-actions">
                            <button class="delete-btn" onclick="deleteArchiveGallery('${doc.id}')">삭제</button>
                        </div>
                    </div>
                    ${data.imageUrl ? `<img src="${data.imageUrl}" class="content-preview" alt="아카이브 이미지">` : ''}
                    <p>${data.description || '설명 없음'}</p>
                    <p><strong>카테고리:</strong> ${getCategoryName(data.category)}</p>
                </div>
            `;
        });
        
        container.innerHTML = html;
    } catch (error) {
        console.error("❌ 아카이브 갤러리 목록 로딩 실패:", error);
        container.innerHTML = '<p style="text-align: center; color: #dc3545;">아카이브 갤러리 목록을 불러오는데 실패했습니다.</p>';
    }
}

function getCategoryName(category) {
    const categories = {
        'production': '제작 현장',
        'interview': '인터뷰',
        'daily': '일상',
        'document': '자료'
    };
    return categories[category] || category;
}

// 시스템 로그 관련 함수들
async function loadSystemLogs() {
    console.log("⚙️ 시스템 로그 로딩");
    try {
        document.getElementById("total-errors").textContent = "23";
        document.getElementById("today-errors").textContent = "2";
        document.getElementById("active-sessions").textContent = "45";
        document.getElementById("uptime-hours").textContent = "127";
    } catch (error) {
        console.error("❌ 시스템 로그 로딩 실패:", error);
    }
}

async function loadErrorLogs() {
    console.log("🚨 오류 로그 로딩");
    const container = document.getElementById("error-logs");
    container.innerHTML = `
        <div class="content-item urgent-item">
            <h4>🚨 Firebase 연결 오류</h4>
            <p>1시간 전 - Firebase 연결이 일시적으로 중단되었습니다.</p>
        </div>
        <div class="content-item">
            <h4>⚠️ 이미지 업로드 실패</h4>
            <p>3시간 전 - 사용자 이미지 업로드 중 오류가 발생했습니다.</p>
        </div>
    `;
}

async function loadActivityLogs() {
    console.log("📊 활동 로그 로딩");
    const container = document.getElementById("activity-logs");
    container.innerHTML = `
        <div class="content-item">
            <h4>📝 새 일기 작성</h4>
            <p>30분 전 - 관리자가 새 일기를 작성했습니다.</p>
        </div>
        <div class="content-item">
            <h4>🎥 영상 업로드</h4>
            <p>2시간 전 - 새 영상이 업로드되었습니다.</p>
        </div>
        <div class="content-item">
            <h4>💬 채팅 세션 시작</h4>
            <p>1시간 전 - 새 사용자가 채팅을 시작했습니다.</p>
        </div>
    `;
}

async function loadDatabaseStatus() {
    console.log("💾 데이터베이스 상태 로딩");
    const container = document.getElementById("database-status");
    container.innerHTML = `
        <div class="content-item">
            <h4>✅ 연결 상태: 정상</h4>
            <p>Firebase Firestore 연결이 정상입니다.</p>
        </div>
        <div class="content-item">
            <h4>📊 저장소 사용량: 45%</h4>
            <p>현재 저장소 사용량이 양호합니다.</p>
        </div>
        <div class="content-item">
            <h4>⚡ 응답 시간: 120ms</h4>
            <p>데이터베이스 응답 시간이 정상 범위입니다.</p>
        </div>
    `;
}

async function loadPerformanceMetrics() {
    console.log("📈 성능 지표 로딩");
    const container = document.getElementById("performance-metrics");
    container.innerHTML = `
        <div class="content-item">
            <h4>⚡ 평균 로딩 시간: 1.2초</h4>
            <p>페이지 로딩 속도가 양호합니다.</p>
        </div>
        <div class="content-item">
            <h4>📱 모바일 호환성: 98%</h4>
            <p>모바일 장치에서 정상 작동합니다.</p>
        </div>
        <div class="content-item">
            <h4>🔒 보안 점수: A+</h4>
            <p>보안 설정이 우수합니다.</p>
        </div>
    `;
}

// 시스템 관리 함수들
async function clearOldLogs() {
    if (confirm("30일 이상된 로그를 모두 삭제하시겠습니까?")) {
        showMessage(document.getElementById("system-management-message"), "오래된 로그가 성공적으로 정리되었습니다.", "success");
    }
}

async function backupData() {
    showMessage(document.getElementById("system-management-message"), "데이터 백업이 시작되었습니다. 완료되면 알림을 드리겠습니다.", "success");
}

async function systemHealthCheck() {
    showMessage(document.getElementById("system-management-message"), "시스템 건강 체크가 완료되었습니다. 모든 시스템이 정상 작동 중입니다.", "success");
}

// 삭제 함수들
window.deleteDiary = async function(docId) {
    if (confirm("이 일기를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "diaryPosts", docId));
            showMessage(document.getElementById("diary-message"), "일기가 성공적으로 삭제되었습니다.", "success");
            loadDiaryList();
        } catch (error) {
            console.error("❌ 일기 삭제 실패:", error);
            showMessage(document.getElementById("diary-message"), "일기 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteTimeline = async function(docId) {
    if (confirm("이 타임라인 이벤트를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "personalTimeline", docId));
            showMessage(document.getElementById("timeline-message"), "타임라인 이벤트가 성공적으로 삭제되었습니다.", "success");
            loadTimelineList();
        } catch (error) {
            console.error("❌ 타임라인 삭제 실패:", error);
            showMessage(document.getElementById("timeline-message"), "타임라인 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteGallery = async function(docId) {
    if (confirm("이 갤러리 사진을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "galleryPosts", docId));
            showMessage(document.getElementById("gallery-message"), "갤러리 사진이 성공적으로 삭제되었습니다.", "success");
            loadGalleryList();
        } catch (error) {
            console.error("❌ 갤러리 삭제 실패:", error);
            showMessage(document.getElementById("gallery-message"), "갤러리 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteVideo = async function(docId) {
    if (confirm("이 영상을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "documentaryVideos", docId));
            showMessage(document.getElementById("video-message"), "영상이 성공적으로 삭제되었습니다.", "success");
            loadVideoList();
        } catch (error) {
            console.error("❌ 영상 삭제 실패:", error);
            showMessage(document.getElementById("video-message"), "영상 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveTimeline = async function(docId) {
    if (confirm("이 아카이브 타임라인을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveTimeline", docId));
            showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인이 성공적으로 삭제되었습니다.", "success");
            loadArchiveTimelineList();
        } catch (error) {
            console.error("❌ 아카이브 타임라인 삭제 실패:", error);
            showMessage(document.getElementById("archive-timeline-message"), "아카이브 타임라인 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveVideo = async function(docId) {
    if (confirm("이 아카이브 영상을 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveVideos", docId));
            showMessage(document.getElementById("archive-video-message"), "아카이브 영상이 성공적으로 삭제되었습니다.", "success");
            loadArchiveVideosList();
        } catch (error) {
            console.error("❌ 아카이브 영상 삭제 실패:", error);
            showMessage(document.getElementById("archive-video-message"), "아카이브 영상 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

window.deleteArchiveGallery = async function(docId) {
    if (confirm("이 아카이브 갤러리를 삭제하시겠습니까?")) {
        try {
            await deleteDoc(doc(window.db, "archiveGallery", docId));
            showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리가 성공적으로 삭제되었습니다.", "success");
            loadArchiveGalleryList();
        } catch (error) {
            console.error("❌ 아카이브 갤러리 삭제 실패:", error);
            showMessage(document.getElementById("archive-gallery-message"), "아카이브 갤러리 삭제 중 오류가 발생했습니다.", "error");
        }
    }
};

// showChatDetail 함수를 전역으로 노출
window.showChatDetail = showChatDetail;